"use strict";define("settings",function(){var e=["settings/checkbox","settings/number","settings/textarea","settings/select","settings/array","settings/key","settings/object"];var d;var n=[];var i=0;var v;function l(e,t){var n;var i;if(typeof e!=="string"){e=$(e);e=e.data("type")||e.attr("type")||e.prop("tagName")}i=d.plugins[e.toLowerCase()];if(i==null){return}n=i[t];if(typeof n==="function"){return n}return null}v={deepClone:function(e){if(typeof e==="object"){return JSON.parse(JSON.stringify(e))}return e},createElement:function(e,t,n){var i=document.createElement(e);for(var a in t){if(t.hasOwnProperty(a)){i.setAttribute(a,t[a])}}if(n){i.appendChild(document.createTextNode(n))}return i},initElement:function(e){var t=l(e,"init");if(t!=null){t.call(d,$(e))}},destructElement:function(e){var t=l(e,"destruct");if(t!=null){t.call(d,$(e))}},createElementOfType:function(e,t,n){var i;var a=l(e,"create");if(a!=null){i=$(a.call(d,e,t,n))}else{if(n==null){n={}}if(e!=null){n.type=e}i=$(v.createElement(t||"input",n))}i.data("type",e);v.initElement(i);return i},cleanArray:function(e,t,n){var i=[];if(!t&&n){return e}for(var a=0;a<e.length;a+=1){var r=e[a];if(t){if(r===!!r){r=+r}else if(r&&typeof r.trim==="function"){r=r.trim()}}if(n||r!=null&&r.length){i.push(r)}}return i},isTrue:function(e){return e==="true"||+e===1},isFalse:function(e){return e==="false"||+e===0},readValue:function(e){var t=!v.isFalse(e.data("empty"));var n=!v.isFalse(e.data("trim"));var i=e.data("split");var a=l(e,"get");var r;if(a!=null){return a.call(d,e,n,t)}if(i!=null){t=v.isTrue(e.data("empty"));r=e.val();var s=r!=null&&r.split(i||",")||[];return v.cleanArray(s,n,t)}r=e.val();if(n&&r!=null&&typeof r.trim==="function"){r=r.trim()}if(t||r!==undefined&&(r==null||r.length!==0)){return r}},fillField:function(e,t){var n=l(e,"set");var i=e.data("trim");i=i!=="false"&&+i!==0;if(n!=null){return n.call(d,e,t,i)}if(t instanceof Array){t=t.join(e.data("split")||(i?", ":","))}if(i&&t&&typeof t.trim==="function"){t=t.trim();if(typeof t.toString==="function"){t=t.toString()}}else if(t!=null){if(typeof t.toString==="function"){t=t.toString()}if(i){t=t.trim()}}else{t=""}if(t!==undefined){e.val(t)}},initFields:function(e){$("[data-key]",e).each(function(e,t){t=$(t);var n=l(t,"init");var i=t.data("key").split(".");var a=d.get();if(n!=null){n.call(d,t)}for(var r=0;r<i.length;r+=1){var s=i[r];if(s&&a!=null){a=a[s]}}v.fillField(t,a)})},registerReadyJobs:function(e){i+=e;return i},beforeReadyJobsDecreased:function(e){if(e==null){e=1}if(i>0){i-=e;if(i<=0){for(var t=0;t<n.length;t+=1){n[t]()}n=[]}}},whenReady:function(e){if(i<=0){e()}else{n.push(e)}},persistSettings:function(e,t,n,i){if(t!=null&&t._!=null&&typeof t._!=="string"){t=v.deepClone(t);t._=JSON.stringify(t._)}socket.emit("admin.settings.set",{hash:e,values:t},function(e){if(n){if(e){app.alert({title:"Settings Not Saved",type:"danger",message:"NodeBB failed to save the settings.",timeout:5e3})}else{app.alert({title:"Settings Saved",type:"success",message:"Settings have been successfully saved",timeout:2500})}}if(typeof i==="function"){i(e)}})},use:function(e){try{e._=JSON.parse(e._)}catch(e){}d.cfg=e}};d={helper:v,plugins:{},cfg:{},get:function(){if(d.cfg!=null&&d.cfg._!==undefined){return d.cfg._}return d.cfg},registerPlugin:function(e,t){if(t==null){t=e.types}else{e.types=t}if(typeof e.use==="function"){e.use.call(d)}for(var n=0;n<t.length;n+=1){var i=t[n].toLowerCase();if(d.plugins[i]==null){d.plugins[i]=e}}},set:function(e,t,n,i,a){if(a==null){a=true}v.whenReady(function(){v.use(t);v.initFields(n||"form");v.persistSettings(e,t,a,i)})},sync:function(e,n,i){socket.emit("admin.settings.get",{hash:e},function(e,t){if(e){if(typeof i==="function"){i(e)}}else{v.whenReady(function(){v.use(t);v.initFields(n||"form");if(typeof i==="function"){i()}})}})},persist:function(e,t,n,i){var a=[];var r=$("[data-key]",t||"form").toArray();if(i==null){i=true}for(var s=0;s<r.length;s+=1){var l=$(r[s]);var f=v.readValue(l);var u=d.get();var o=l.data("key").split(".");var c=o[o.length-1];if(o.length>1){for(var g=0;g<o.length-1;g+=1){var p=o[g];if(p&&u!=null){u=u[p]}}}if(u!=null){if(f!=null){u[c]=f}else{delete u[c]}}else{a.push(l.data("key"))}}if(a.length){app.alert({title:"Attributes Not Saved",message:"'"+a.join(", ")+"' could not be saved. Please contact the plugin-author!",type:"danger",timeout:5e3})}v.persistSettings(e,d.cfg,i,n)},load:function(e,n,i){i=i||function(){};socket.emit("admin.settings.get",{hash:e},function(e,t){if(e){return i(e)}ajaxify.data.settings=t;$(n).deserialize(t);$(n).find('input[type="checkbox"]').each(function(){$(this).parents(".mdl-switch").toggleClass("is-checked",$(this).is(":checked"))});$(window).trigger("action:admin.settingsLoaded");$(n).on("change","input, select, textarea",function(){app.flags=app.flags||{};app.flags._unsaved=true});i(null,t)})},save:function(e,t,n){t=$(t);if(t.length){var i=t.serializeObject();t.find('input[type="checkbox"]').each(function(e,t){t=$(t);if(!t.is(":checked")){i[t.attr("name")]="off"}});socket.emit("admin.settings.set",{hash:e,values:i},function(e){app.flags._unsaved=false;ajaxify.data.settings=i;if(typeof n==="function"){n(e)}else if(e){app.alert({title:"Error while saving settings",type:"error",timeout:2500})}else{app.alert({title:"Settings Saved",type:"success",timeout:2500})}})}}};v.registerReadyJobs(1);require(e,function(){for(var e=0;e<arguments.length;e+=1){d.registerPlugin(arguments[e])}v.beforeReadyJobsDecreased()});return d});
//# sourceMappingURL=public/src/modules/settings.js.map