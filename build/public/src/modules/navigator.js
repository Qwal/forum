"use strict";define("navigator",["forum/pagination","components"],function(r,d){var p={};var u=1;var g=0;var o;p.scrollActive=false;$(window).on("action:ajaxify.start",function(){$(window).off("keydown",t)});p.init=function(o,i,t,n,e,a){u=1;p.selector=o;p.callback=e;p.toTop=t||function(){};p.toBottom=n||function(){};$(window).off("scroll",p.delayedUpdate).on("scroll",p.delayedUpdate);$(".pagination-block .dropdown-menu").off("click").on("click",function(o){o.stopPropagation()});$(".pagination-block").off("shown.bs.dropdown",".dropdown").on("shown.bs.dropdown",".dropdown",function(){setTimeout(function(){$(".pagination-block input").focus()},100)});$(".pagination-block .pageup").off("click").on("click",p.scrollUp);$(".pagination-block .pagedown").off("click").on("click",p.scrollDown);$(".pagination-block .pagetop").off("click").on("click",p.toTop);$(".pagination-block .pagebottom").off("click").on("click",p.toBottom);$(".pagination-block input").on("keydown",function(o){if(o.which===13){var t=$(this);if(!utils.isNumber(t.val())){t.val("");return}var n=parseInt(t.val(),10);if(typeof a==="function"){n=a(n,i)}var e=c(n);t.val("");$(".pagination-block .dropdown-toggle").trigger("click");ajaxify.go(e)}});l();p.setCount(i);p.update(0)};function l(){if(!config.usePagination){$(window).off("keydown",t).on("keydown",t)}}function t(o){if(o.target.nodeName==="BODY"){if(o.shiftKey||o.ctrlKey||o.altKey){return}if(o.which===36&&p.toTop){p.toTop();return false}else if(o.which===35&&p.toBottom){p.toBottom();return false}}}function c(o){var t=window.location.pathname.replace(config.relative_path,"");var n=t.split("/");return n[1]+"/"+n[2]+"/"+n[3]+(o?"/"+o:"")}p.setCount=function(o){g=parseInt(o,10);p.updateTextAndProgressBar()};p.show=function(){h(true)};p.disable=function(){g=0;u=1;p.callback=null;p.selector=null;$(window).off("scroll",p.delayedUpdate);h(false)};function h(o){var t=ajaxify.removeRelativePath(window.location.pathname.slice(1));if(o&&(!t.startsWith("topic")&&!t.startsWith("category"))){return}$(".pagination-block").toggleClass("ready",o)}p.delayedUpdate=function(){if(!o){o=setTimeout(function(){p.update();o=undefined},100)}};p.update=function(o){o=typeof o==="number"?o:undefined;var t=$(p.selector);if(t.length){u=parseInt(t.first().attr("data-index"),10)+1}var n=$(window).scrollTop();var e=$(window).height();var i=$(document).height();var a=n+e/2;var l=Number.MAX_VALUE;t.each(function(){var o=Math.abs(a-$(this).offset().top);if(o>l){return false}if(o<l){u=parseInt($(this).attr("data-index"),10)+1;l=o}});var r=n===0&&parseInt(t.first().attr("data-index"),10)===0;var c=n+e>i-100&&parseInt(t.last().attr("data-index"),10)===g-1;if(r){u=1}else if(c){u=g}if(o===undefined&&ajaxify.data.template.topic===true){if(r){o=0}else{var s=d.get("post/anchor",u-1);if(s.length){var f=s.get(0).getBoundingClientRect();o=f.top}}}if(typeof p.callback==="function"){p.callback(u,g,o)}p.updateTextAndProgressBar();h(!!g)};p.updateTextAndProgressBar=function(){if(!utils.isNumber(u)){return}u=u>g?g:u;var o=n();$(".pagination-block .pagination-text").translateHtml("[[global:pagination.out_of, "+o+", "+g+"]]");var t=(o-1)/(g-1||1);$(".pagination-block meter").val(t);$(".pagination-block .progress-bar").width(t*100+"%")};function n(){var o=u;if(o===1){return 1}if(ajaxify.data.template.topic){if(config.topicPostSort==="most_votes"||config.topicPostSort==="newest_to_oldest"){o=ajaxify.data.postcount-u+2}}return o}p.scrollUp=function(){$("body,html").animate({scrollTop:$(window).scrollTop()-$(window).height()})};p.scrollDown=function(){$("body,html").animate({scrollTop:$(window).scrollTop()+$(window).height()})};p.scrollTop=function(o){if($(p.selector+'[data-index="'+o+'"]').length){p.scrollToIndex(o,true)}else{ajaxify.go(c())}};p.scrollBottom=function(o){if(parseInt(o,10)<0){return}if($(p.selector+'[data-index="'+o+'"]').length){p.scrollToIndex(o,true)}else{o=parseInt(o,10)+1;ajaxify.go(c(o))}};p.scrollToPost=function(o,t,n){console.log("[navigator.scrollToPost] deprecated please use, navigator.scrollToIndex");p.scrollToIndex(o,t,n)};p.scrollToIndex=function(o,t,n){var e=!!d.get("topic").length;var i=!!d.get("category").length;if(!utils.isNumber(o)||!e&&!i){return}n=n!==undefined?n:400;p.scrollActive=true;if(e&&d.get("post/anchor",o).length){return p.scrollToPostIndex(o,t,n)}if(i&&$('[component="category/topic"][data-index="'+o+'"]').length){return p.scrollToTopicIndex(o,t,n)}if(!config.usePagination){p.scrollActive=false;o=parseInt(o,10)+1;ajaxify.go(c(o));return}var a=e?p.scrollToPostIndex:p.scrollToTopicIndex;if(e){if(config.topicPostSort==="most_votes"||config.topicPostSort==="newest_to_oldest"){o=ajaxify.data.postcount-o}}else if(i){if(config.categoryTopicSort==="most_posts"||config.categoryTopicSort==="oldest_to_newest"){o=ajaxify.data.topic_count-o}}var l=Math.max(1,Math.ceil((o+1)/config.postsPerPage));if(parseInt(l,10)!==ajaxify.data.pagination.currentPage){r.loadPage(l,function(){a(o,t,n)})}else{a(o,t,n)}};p.scrollToPostIndex=function(o,t,n){var e=d.get("post","index",o);p.scrollToElement(e,t,n)};p.scrollToTopicIndex=function(o,t,n){var e=$('[component="category/topic"][data-index="'+o+'"]');p.scrollToElement(e,t,n)};p.scrollToElement=function(t,o,n){if(!t.length){p.scrollActive=false;return}var e=t.height();var i=$(window).height();var a=d.get("navbar").height();$(window).off("scroll",p.update);n=n!==undefined?n:400;p.scrollActive=true;var l=false;function r(){var o=0;if(e<i){o=t.offset().top-i/2+e/2}else{o=t.offset().top-a}$("html, body").animate({scrollTop:o+"px"},n,function(){if(l){$(window).on("scroll",p.update);var o=t.get(0).getBoundingClientRect();p.update(o.top);return}l=true;p.scrollActive=false;c();$("body").scrollTop($("body").scrollTop()-1);$("html").scrollTop($("html").scrollTop()-1)})}function c(){if(o){t.addClass("highlight");setTimeout(function(){t.removeClass("highlight")},1e4)}}r()};return p});
//# sourceMappingURL=public/src/modules/navigator.js.map