"use strict";define("pictureCropper",["translator","cropper","benchpress"],function(i,s,t){var d={};d.show=function(a,i){var e=a.hasOwnProperty("fileSize")&&a.fileSize!==undefined?parseInt(a.fileSize,10):false;r({showHelp:a.hasOwnProperty("showHelp")&&a.showHelp!==undefined?a.showHelp:true,fileSize:e,title:a.title||"[[global:upload_file]]",description:a.description||"",button:a.button||"[[global:upload]]",accept:a.accept?a.accept.replace(/,/g,"&#44; "):""},function(e){e=$(e);e.modal("show");e.on("hidden.bs.modal",function(){e.remove()});e.find("#fileUploadSubmitBtn").on("click",function(){$(this).addClass("disabled");a.uploadModal=e;o(a,i);return false})})};d.handleImageCrop=function(r,n){$("#crop-picture-modal").remove();t.parse("modals/crop_picture",{url:r.url},function(e){i.translate(e,function(e){var i=$(e);i.modal({backdrop:"static"}).modal("show");var a=parseInt($(window).height()/2,10);var t=document.getElementById("cropped-image");$(t).css("max-height",a);var o=new s(t,{aspectRatio:r.aspectRatio,autoCropArea:1,viewMode:1,cropmove:function(){if(r.restrictImageDimension){if(o.cropBoxData.width>r.imageDimension){o.setCropBoxData({width:r.imageDimension})}if(o.cropBoxData.height>r.imageDimension){o.setCropBoxData({height:r.imageDimension})}}},ready:function(){if(r.restrictImageDimension){var e=t.width<t.height?t.width:t.height;var a=e>r.imageDimension?r.imageDimension:e;o.setCropBoxData({width:a,height:a})}i.find(".rotate").on("click",function(){var e=this.getAttribute("data-degrees");o.rotate(e)});i.find(".flip").on("click",function(){var e=this.getAttribute("data-option");var a=this.getAttribute("data-method");if(a==="scaleX"){o.scaleX(e)}else{o.scaleY(e)}this.setAttribute("data-option",e*-1)});i.find(".reset").on("click",function(){o.reset()});i.find(".crop-btn").on("click",function(){$(this).addClass("disabled");var e=r.imageType?o.getCroppedCanvas().toDataURL(r.imageType):o.getCroppedCanvas().toDataURL();i.find("#upload-progress-bar").css("width","100%");i.find("#upload-progress-box").show().removeClass("hide");var a={};a[r.paramName]=r.paramValue;a.imageData=e;socket.emit(r.socketMethod,a,function(e,a){if(e){i.find("#upload-progress-box").hide();i.find(".upload-btn").removeClass("disabled");i.find(".crop-btn").removeClass("disabled");return app.alertError(e.message)}n(a.url);i.modal("hide")})});i.find(".upload-btn").on("click",function(){$(this).addClass("disabled");o.destroy();o=new s(t,{viewMode:1,autoCropArea:1,ready:function(){i.find(".crop-btn").trigger("click")}})})}})})})};function o(i,e){function a(e,a){d.hideAlerts(i.uploadModal);if(e==="error"){i.uploadModal.find("#fileUploadSubmitBtn").removeClass("disabled")}i.uploadModal.find("#alert-"+e).translateText(a).removeClass("hide")}var t=i.uploadModal.find("#fileInput");if(!t.val()){return a("error","[[uploads:select-file-to-upload]]")}var o=t[0].files[0];var r=new FileReader;var n;var s=o.type;r.addEventListener("load",function(){n=r.result;i.uploadModal.modal("hide");d.handleImageCrop({url:n,imageType:s,socketMethod:i.socketMethod,aspectRatio:i.aspectRatio,allowSkippingCrop:i.allowSkippingCrop,restrictImageDimension:i.restrictImageDimension,imageDimension:i.imageDimension,paramName:i.paramName,paramValue:i.paramValue},e)},false);if(o){r.readAsDataURL(o)}}function r(e,a){t.parse("partials/modals/upload_file_modal",e,function(e){i.translate(e,a)})}return d});
//# sourceMappingURL=public/src/modules/pictureCropper.js.map