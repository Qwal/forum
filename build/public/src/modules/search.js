"use strict";define("search",["navigator","translator","storage"],function(i,n,e){var a={current:{}};a.query=function(e,t){var r=e.term;var i=r.match(/^in:topic-([\d]+) /);if(!i){r=r.replace(/^[ ?#]*/,"");try{r=encodeURIComponent(r)}catch(e){return app.alertError("[[error:invalid-search-term]]")}ajaxify.go("search?"+c(e));t()}else{var n=r.replace(i[0],"");var s=i[1];if(n.length>0){a.queryTopic(s,n,t)}}};function c(e){var t=e.in||"titlesposts";var r=e.by||"";var i={term:e.term,in:t};if(r&&(t==="posts"||t==="titles"||t==="titlesposts")){i.by=r}if(e.categories&&e.categories.length){i.categories=e.categories;if(e.searchChildren){i.searchChildren=e.searchChildren}}if(e.hasTags&&e.hasTags.length){i.hasTags=e.hasTags}if(parseInt(e.replies,10)>0){i.replies=e.replies;i.repliesFilter=e.repliesFilter||"atleast"}if(e.timeRange){i.timeRange=e.timeRange;i.timeFilter=e.timeFilter||"newer"}if(e.sortBy){i.sortBy=e.sortBy;i.sortDirection=e.sortDirection}if(e.showAs){i.showAs=e.showAs}$(window).trigger("action:search.createQueryString",{query:i,data:e});return decodeURIComponent($.param(i))}a.getSearchPreferences=function(){try{return JSON.parse(e.getItem("search-preferences")||"{}")}catch(e){return{}}};a.queryTopic=function(r,i){socket.emit("topics.search",{tid:r,term:i},function(e,t){if(e){return app.alertError(e.message)}if(Array.isArray(t)){a.current={results:t.sort(function(e,t){return e-t}),tid:r,term:i};a.checkPagePresence(r,function(){a.topicDOM.update(0)})}})};a.checkPagePresence=function(e,t){if(parseInt(ajaxify.data.tid,10)!==parseInt(e,10)){ajaxify.go("topic/"+e,t)}else{t()}};a.topicDOM={active:false};a.topicDOM.prev=function(){a.topicDOM.update(a.current.index===0?a.current.results.length-1:a.current.index-1)};a.topicDOM.next=function(){a.topicDOM.update(a.current.index===a.current.results.length-1?0:a.current.index+1)};a.topicDOM.update=function(e){var t=$(".topic-search");a.current.index=e;a.topicDOM.start();if(a.current.results.length>0){t.find(".count").html(e+1+" / "+a.current.results.length);t.find(".prev, .next").removeAttr("disabled");var r={pid:a.current.results[e],tid:a.current.tid,topicPostSort:config.topicPostSort};socket.emit("posts.getPidIndex",r,function(e,t){if(e){return app.alertError(e.message)}i.scrollToIndex(t,true)})}else{n.translate("[[search:no-matches]]",function(e){t.find(".count").html(e)});t.removeClass("hidden").find(".prev, .next").attr("disabled","disabled")}};a.topicDOM.start=function(){$(".topic-search").removeClass("hidden");if(!a.topicDOM.active){a.topicDOM.active=true;require(["mousetrap"],function(e){e.bind("esc",a.topicDOM.end)})}};a.topicDOM.end=function(){$(".topic-search").addClass("hidden").find(".prev, .next").attr("disabled","disabled");a.topicDOM.active=false;require(["mousetrap"],function(e){e.unbind("esc",a.topicDOM.end)})};return a});
//# sourceMappingURL=public/src/modules/search.js.map