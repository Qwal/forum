"use strict";define("forum/account/edit",["forum/account/header","translator","components","pictureCropper","benchpress"],function(a,r,t,n,u){var e={};e.init=function(){a.init();$("#submitBtn").on("click",i);app.loadJQueryUI(function(){$("#inputBirthday").datepicker({changeMonth:true,changeYear:true,yearRange:"1900:-5y",defaultDate:"-13y"})});c();l();f();m();h()};function i(){var a={uid:$("#inputUID").val(),fullname:$("#inputFullname").val(),website:$("#inputWebsite").val(),birthday:$("#inputBirthday").val(),location:$("#inputLocation").val(),groupTitle:$("#groupTitle").val(),signature:$("#inputSignature").val(),aboutme:$("#inputAboutMe").val()};$(window).trigger("action:profile.update",a);socket.emit("user.updateProfile",a,function(a,t){if(a){return app.alertError(a.message)}app.alertSuccess("[[user:profile_update_success]]");if(t.picture){$("#user-current-picture").attr("src",t.picture)}o(t.picture)});return false}function o(a){if(parseInt(ajaxify.data.theirid,10)!==parseInt(ajaxify.data.yourid,10)){return}if(!a&&ajaxify.data.defaultAvatar){a=ajaxify.data.defaultAvatar}t.get("header/userpicture")[a?"show":"hide"]();t.get("header/usericon")[!a?"show":"hide"]();if(a){t.get("header/userpicture").attr("src",a)}}function c(){$("#changePictureBtn").on("click",function(){socket.emit("user.getProfilePictures",{uid:ajaxify.data.uid},function(a,t){if(a){return app.alertError(a.message)}var e=t.reduce(function(a,t){return a||t.type==="uploaded"},false);u.parse("partials/modals/change_picture_modal",{pictures:t,uploaded:e,icon:{text:ajaxify.data["icon:text"],bgColor:ajaxify.data["icon:bgColor"]},defaultAvatar:ajaxify.data.defaultAvatar,allowProfileImageUploads:ajaxify.data.allowProfileImageUploads},function(a){r.translate(a,function(a){var e=bootbox.dialog({className:"picture-switcher",title:"[[user:change_picture]]",message:a,show:true,buttons:{close:{label:"[[global:close]]",callback:r,className:"btn-link"},update:{label:"[[global:save_changes]]",callback:i}}});e.on("shown.bs.modal",t);e.on("click",".list-group-item",function a(){e.find(".list-group-item").removeClass("active");$(this).addClass("active")});s(e);function t(){if(!ajaxify.data.picture){e.find(".list-group-item .user-icon").parents(".list-group-item").addClass("active")}else{e.find(".list-group-item img").each(function(){if(this.getAttribute("src")===ajaxify.data.picture){$(this).parents(".list-group-item").addClass("active")}})}}function i(){var t=e.find(".list-group-item.active").attr("data-type");d(t,function(a){if(a){return app.alertError(a.message)}o(t==="default"?"":e.find(".list-group-item.active img").attr("src"));ajaxify.refresh()})}function r(){e.modal("hide")}})})});return false})}function l(){$("#deleteAccountBtn").on("click",function(){r.translate("[[user:delete_account_confirm]]",function(a){var t=bootbox.confirm(a+'<p><input type="text" class="form-control" id="confirm-username" /></p>',function(a){if(!a){return}if($("#confirm-username").val()!==app.user.username){app.alertError("[[error:invalid-username]]");return false}socket.emit("user.deleteAccount",{},function(a){if(a){return app.alertError(a.message)}window.location.href=config.relative_path+"/"})});t.on("shown.bs.modal",function(){t.find("input").focus()})});return false})}function s(t){function e(a){a=(!a.startsWith("http")?config.relative_path:"")+a+"?"+Date.now();o(a);if(ajaxify.data.picture.length){$("#user-current-picture, img.avatar").attr("src",a);ajaxify.data.uploadedpicture=a}else{ajaxify.refresh(function(){$("#user-current-picture, img.avatar").attr("src",a)})}}function i(){if(ajaxify.data.uploadedpicture===ajaxify.data.picture){ajaxify.refresh();o()}}t.find('[data-action="upload"]').on("click",function(){t.modal("hide");n.show({socketMethod:"user.uploadCroppedPicture",aspectRatio:1/1,paramName:"uid",paramValue:ajaxify.data.theirid,fileSize:ajaxify.data.maximumProfileImageSize,allowSkippingCrop:false,title:"[[user:upload_picture]]",description:"[[user:upload_a_picture]]",accept:".png,.jpg,.bmp"},function(a){e(a)});return false});t.find('[data-action="upload-url"]').on("click",function(){t.modal("hide");u.parse("partials/modals/upload_picture_from_url_modal",{},function(a){r.translate(a,function(a){var t=$(a);t.modal("show");t.find(".upload-btn").on("click",function(){var a=t.find("#uploadFromUrl").val();if(!a){return false}t.modal("hide");n.handleImageCrop({url:a,socketMethod:"user.uploadCroppedPicture",aspectRatio:1,allowSkippingCrop:false,paramName:"uid",paramValue:ajaxify.data.theirid},e);return false})})});return false});t.find('[data-action="remove-uploaded"]').on("click",function(){socket.emit("user.removeUploadedPicture",{uid:ajaxify.data.theirid},function(a){t.modal("hide");if(a){return app.alertError(a.message)}i()})})}function f(){$("#confirm-email").on("click",function(){var t=$(this).attr("disabled",true);socket.emit("user.emailConfirm",{},function(a){t.removeAttr("disabled");if(a){return app.alertError(a.message)}app.alertSuccess("[[notifications:email-confirm-sent]]")})})}function d(a,t){socket.emit("user.changePicture",{type:a,uid:ajaxify.data.theirid},t)}function p(a,t){return a.length?"("+a.val().length+"/"+t+")":""}function m(){var a=$("#inputSignature");$("#signatureCharCountLeft").html(p(a,ajaxify.data.maximumSignatureLength));a.on("keyup change",function(){$("#signatureCharCountLeft").html(p(a,ajaxify.data.maximumSignatureLength))})}function h(){var a=$("#inputAboutMe");$("#aboutMeCharCountLeft").html(p(a,ajaxify.data.maximumAboutMeLength));a.on("keyup change",function(){$("#aboutMeCharCountLeft").html(p(a,ajaxify.data.maximumAboutMeLength))})}return e});
//# sourceMappingURL=public/src/client/account/edit.js.map