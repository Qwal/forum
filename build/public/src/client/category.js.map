{"version":3,"sources":["public/src/client/category.js"],"names":["define","infinitescroll","share","navigator","categoryTools","recent","sort","components","translator","topicSelect","pagination","storage","Category","$","window","on","ev","data","String","url","startsWith","disable","removeListeners","init","cid","ajaxify","app","enterRoom","addShareHandlers","name","watchForNewPosts","handleSort","slug","enableInfiniteLoadingOrPagination","clickedIndex","this","parents","attr","each","index","el","offset","top","scrollTop","setItem","handleScrollToTopicIndex","handleIgnoreWatch","trigger","topics","parts","location","pathname","split","topicIndex","length","utils","isNumber","Math","max","parseInt","search","indexOf","scrollToElement","$this","command","socket","emit","err","alertError","message","toggleClass","alertSuccess","toTop","toBottom","count","scrollBottom","navigatorCallback","topIndex","bottomIndex","template","category","bookmarkIndex","getItem","removeItem","config","usePagination","page","ceil","topicsPerPage","currentPage","loadPage","scrollToTopic","highlightTopic","empty","loadTopicsAfter","one","highlight","get","hasClass","addClass","setTimeout","removeClass","duration","scrollTo","animate","undefined","update","topic_count","loadMoreTopics","direction","children","afterEl","last","first","after","callback","params","loadMore","query","categoryTopicSort","done","onTopicsLoaded","removeAlreadyAddedTopics","filter","topic","tid","showSelect","privileges","editable","before","parseAndTranslate","html","remove","insertAfter","height","document","insertBefore","append","getSelectedTids","removeExtra","find","timeago","createUserTooltips","makeNumbersHumanReadable"],"mappings":"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","file":"public/src/client/category.js","sourcesContent":["'use strict';\n\n\ndefine('forum/category', [\n\t'forum/infinitescroll',\n\t'share',\n\t'navigator',\n\t'forum/category/tools',\n\t'forum/recent',\n\t'sort',\n\t'components',\n\t'translator',\n\t'topicSelect',\n\t'forum/pagination',\n\t'storage',\n], function (infinitescroll, share, navigator, categoryTools, recent, sort, components, translator, topicSelect, pagination, storage) {\n\tvar Category = {};\n\n\t$(window).on('action:ajaxify.start', function (ev, data) {\n\t\tif (!String(data.url).startsWith('category/')) {\n\t\t\tnavigator.disable();\n\n\t\t\tremoveListeners();\n\t\t}\n\t});\n\n\tfunction removeListeners() {\n\t\tcategoryTools.removeListeners();\n\t\trecent.removeListeners();\n\t}\n\n\tCategory.init = function () {\n\t\tvar\tcid = ajaxify.data.cid;\n\n\t\tapp.enterRoom('category_' + cid);\n\n\t\tshare.addShareHandlers(ajaxify.data.name);\n\n\t\tcategoryTools.init(cid);\n\t\trecent.watchForNewPosts();\n\n\t\tsort.handleSort('categoryTopicSort', 'user.setCategorySort', 'category/' + ajaxify.data.slug);\n\n\t\tenableInfiniteLoadingOrPagination();\n\n\t\t$('[component=\"category\"]').on('click', '[component=\"topic/header\"]', function () {\n\t\t\tvar clickedIndex = $(this).parents('[data-index]').attr('data-index');\n\t\t\t$('[component=\"category/topic\"]').each(function (index, el) {\n\t\t\t\tif ($(el).offset().top - $(window).scrollTop() > 0) {\n\t\t\t\t\tstorage.setItem('category:' + cid + ':bookmark', $(el).attr('data-index'));\n\t\t\t\t\tstorage.setItem('category:' + cid + ':bookmark:clicked', clickedIndex);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\thandleScrollToTopicIndex();\n\n\t\thandleIgnoreWatch(cid);\n\n\t\t$(window).trigger('action:topics.loaded', { topics: ajaxify.data.topics });\n\t\t$(window).trigger('action:category.loaded', { cid: ajaxify.data.cid });\n\t};\n\n\tfunction handleScrollToTopicIndex() {\n\t\tvar parts = window.location.pathname.split('/');\n\t\tvar topicIndex = parts[parts.length - 1];\n\t\tif (topicIndex && utils.isNumber(topicIndex)) {\n\t\t\ttopicIndex = Math.max(0, parseInt(topicIndex, 10) - 1);\n\t\t\tif (topicIndex && window.location.search.indexOf('page=') === -1) {\n\t\t\t\tnavigator.scrollToElement($('[component=\"category/topic\"][data-index=\"' + topicIndex + '\"]'), true, 0);\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction handleIgnoreWatch(cid) {\n\t\t$('[component=\"category/watching\"], [component=\"category/ignoring\"]').on('click', function () {\n\t\t\tvar $this = $(this);\n\t\t\tvar command = $this.attr('component') === 'category/watching' ? 'watch' : 'ignore';\n\n\t\t\tsocket.emit('categories.' + command, cid, function (err) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t}\n\n\t\t\t\t$('[component=\"category/watching/menu\"]').toggleClass('hidden', command !== 'watch');\n\t\t\t\t$('[component=\"category/watching/check\"]').toggleClass('fa-check', command === 'watch');\n\n\t\t\t\t$('[component=\"category/ignoring/menu\"]').toggleClass('hidden', command !== 'ignore');\n\t\t\t\t$('[component=\"category/ignoring/check\"]').toggleClass('fa-check', command === 'ignore');\n\n\t\t\t\tapp.alertSuccess('[[category:' + command + '.message]]');\n\t\t\t});\n\t\t});\n\t}\n\n\tCategory.toTop = function () {\n\t\tnavigator.scrollTop(0);\n\t};\n\n\tCategory.toBottom = function () {\n\t\tsocket.emit('categories.getTopicCount', ajaxify.data.cid, function (err, count) {\n\t\t\tif (err) {\n\t\t\t\treturn app.alertError(err.message);\n\t\t\t}\n\n\t\t\tnavigator.scrollBottom(count - 1);\n\t\t});\n\t};\n\n\tCategory.navigatorCallback = function (topIndex, bottomIndex) {\n\t\treturn bottomIndex;\n\t};\n\n\t$(window).on('action:popstate', function () {\n\t\tif (ajaxify.data.template.category && ajaxify.data.cid) {\n\t\t\tvar bookmarkIndex = storage.getItem('category:' + ajaxify.data.cid + ':bookmark');\n\t\t\tvar clickedIndex = storage.getItem('category:' + ajaxify.data.cid + ':bookmark:clicked');\n\n\t\t\tstorage.removeItem('category:' + ajaxify.data.cid + ':bookmark');\n\t\t\tstorage.removeItem('category:' + ajaxify.data.cid + ':bookmark:clicked');\n\n\t\t\tbookmarkIndex = Math.max(0, parseInt(bookmarkIndex, 10) || 0);\n\t\t\tclickedIndex = Math.max(0, parseInt(clickedIndex, 10) || 0);\n\t\t\tif (!parseInt(bookmarkIndex, 10)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (config.usePagination) {\n\t\t\t\tvar page = Math.ceil((parseInt(bookmarkIndex, 10) + 1) / config.topicsPerPage);\n\t\t\t\tif (parseInt(page, 10) !== ajaxify.data.pagination.currentPage) {\n\t\t\t\t\tpagination.loadPage(page, function () {\n\t\t\t\t\t\tCategory.scrollToTopic(bookmarkIndex, clickedIndex, 0);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tCategory.scrollToTopic(bookmarkIndex, clickedIndex, 0);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (bookmarkIndex === 0) {\n\t\t\t\t\tCategory.highlightTopic(clickedIndex);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t$('[component=\"category\"]').empty();\n\n\t\t\t\tloadTopicsAfter(Math.max(0, bookmarkIndex - 1) + 1, 1, function () {\n\t\t\t\t\t$(window).one('action:topics.loaded', function () {\n\t\t\t\t\t\tCategory.scrollToTopic(bookmarkIndex, clickedIndex, 0);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t});\n\n\tCategory.highlightTopic = function (topicIndex) {\n\t\tvar highlight = components.get('category/topic', 'index', topicIndex);\n\n\t\tif (highlight.length && !highlight.hasClass('highlight')) {\n\t\t\thighlight.addClass('highlight');\n\t\t\tsetTimeout(function () {\n\t\t\t\thighlight.removeClass('highlight');\n\t\t\t}, 5000);\n\t\t}\n\t};\n\n\tCategory.scrollToTopic = function (bookmarkIndex, clickedIndex, duration, offset) {\n\t\tif (!bookmarkIndex) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!offset) {\n\t\t\toffset = 0;\n\t\t}\n\n\t\tvar scrollTo = components.get('category/topic', 'index', bookmarkIndex);\n\n\t\tif (scrollTo.length) {\n\t\t\t$('html, body').animate({\n\t\t\t\tscrollTop: (scrollTo.offset().top - offset) + 'px',\n\t\t\t}, duration !== undefined ? duration : 400, function () {\n\t\t\t\tCategory.highlightTopic(clickedIndex);\n\t\t\t\tnavigator.update();\n\t\t\t});\n\t\t}\n\t};\n\n\tfunction enableInfiniteLoadingOrPagination() {\n\t\tif (!config.usePagination) {\n\t\t\tnavigator.init('[component=\"category/topic\"]', ajaxify.data.topic_count, Category.toTop, Category.toBottom, Category.navigatorCallback);\n\t\t\tinfinitescroll.init($('[component=\"category\"]'), Category.loadMoreTopics);\n\t\t} else {\n\t\t\tnavigator.disable();\n\t\t}\n\t}\n\n\tCategory.loadMoreTopics = function (direction) {\n\t\tif (!$('[component=\"category\"]').length || !$('[component=\"category\"]').children().length) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar topics = $('[component=\"category/topic\"]');\n\t\tvar afterEl = direction > 0 ? topics.last() : topics.first();\n\t\tvar after = (parseInt(afterEl.attr('data-index'), 10) || 0) + (direction > 0 ? 1 : 0);\n\n\t\tloadTopicsAfter(after, direction);\n\t};\n\n\tfunction loadTopicsAfter(after, direction, callback) {\n\t\tcallback = callback || function () {};\n\t\tif (!utils.isNumber(after) || (after === 0 && components.get('category/topic', 'index', 0).length)) {\n\t\t\treturn callback();\n\t\t}\n\n\t\t$(window).trigger('action:category.loading');\n\t\tvar params = utils.params();\n\t\tinfinitescroll.loadMore('categories.loadMore', {\n\t\t\tcid: ajaxify.data.cid,\n\t\t\tafter: after,\n\t\t\tdirection: direction,\n\t\t\tquery: params,\n\t\t\tcategoryTopicSort: config.categoryTopicSort,\n\t\t}, function (data, done) {\n\t\t\tif (data.topics && data.topics.length) {\n\t\t\t\tCategory.onTopicsLoaded(data, direction, done);\n\t\t\t} else {\n\t\t\t\tdone();\n\t\t\t}\n\n\t\t\t$(window).trigger('action:category.loaded');\n\t\t\tcallback();\n\t\t});\n\t}\n\n\n\tCategory.onTopicsLoaded = function (data, direction, callback) {\n\t\tif (!data || !data.topics.length) {\n\t\t\treturn callback();\n\t\t}\n\n\t\tfunction removeAlreadyAddedTopics(topics) {\n\t\t\treturn topics.filter(function (topic) {\n\t\t\t\treturn components.get('category/topic', 'tid', topic.tid).length === 0;\n\t\t\t});\n\t\t}\n\n\t\tdata.topics = removeAlreadyAddedTopics(data.topics);\n\t\tif (!data.topics.length) {\n\t\t\treturn callback();\n\t\t}\n\n\t\tdata.showSelect = data.privileges.editable;\n\n\t\tvar after;\n\t\tvar before;\n\t\tvar topics = $('[component=\"category/topic\"]');\n\n\t\tif (direction > 0 && topics.length) {\n\t\t\tafter = topics.last();\n\t\t} else if (direction < 0 && topics.length) {\n\t\t\tbefore = topics.first();\n\t\t}\n\n\t\tapp.parseAndTranslate('category', 'topics', data, function (html) {\n\t\t\t$('[component=\"category\"]').removeClass('hidden');\n\t\t\t$('.category-sidebar').removeClass('hidden');\n\n\t\t\t$('#category-no-topics').remove();\n\n\t\t\tif (after) {\n\t\t\t\thtml.insertAfter(after);\n\t\t\t} else if (before) {\n\t\t\t\tvar height = $(document).height();\n\t\t\t\tvar scrollTop = $(window).scrollTop();\n\n\t\t\t\thtml.insertBefore(before);\n\n\t\t\t\t$(window).scrollTop(scrollTop + ($(document).height() - height));\n\t\t\t} else {\n\t\t\t\t$('[component=\"category\"]').append(html);\n\t\t\t}\n\n\t\t\tif (!topicSelect.getSelectedTids().length) {\n\t\t\t\tinfinitescroll.removeExtra($('[component=\"category/topic\"]'), direction, config.topicsPerPage * 3);\n\t\t\t}\n\n\t\t\thtml.find('.timeago').timeago();\n\t\t\tapp.createUserTooltips();\n\t\t\tutils.makeNumbersHumanReadable(html.find('.human-readable-number'));\n\n\t\t\t$(window).trigger('action:topics.loaded', { topics: data.topics });\n\n\t\t\tcallback();\n\t\t});\n\t};\n\n\treturn Category;\n});\n"]}