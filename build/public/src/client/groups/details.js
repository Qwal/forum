"use strict";define("forum/groups/details",["forum/groups/memberlist","iconSelect","components","coverPhoto","pictureCropper","translator","vendor/colorpicker/colorpicker"],function(a,u,p,r,t,n){var s={};var c;s.init=function(){var e=p.get("groups/container");c=ajaxify.data.group.name;if(ajaxify.data.group.isOwner){s.prepareSettings();r.init(p.get("groups/cover"),function(e,a,r){socket.emit("groups.cover.update",{groupName:c,imageData:e,position:a},r)},function(){t.show({title:"[[groups:upload-group-cover]]",socketMethod:"groups.cover.update",aspectRatio:NaN,allowSkippingCrop:true,restrictImageDimension:false,paramName:"groupName",paramValue:c},function(e){p.get("groups/cover").css("background-image","url("+e+")")})},i)}a.init();o();p.get("groups/activity").find(".content img:not(.not-responsive)").addClass("img-responsive");e.on("click","[data-action]",function(){var e=$(this);var a=e.parents("[data-uid]");var r=a.find(".member-name > i");var t=!r.hasClass("invisible");var o=a.attr("data-uid");var i=e.attr("data-action");switch(i){case"toggleOwnership":socket.emit("groups."+(t?"rescind":"grant"),{toUid:o,groupName:c},function(e){if(!e){r.toggleClass("invisible")}else{app.alertError(e.message)}});break;case"kick":n.translate("[[groups:details.kick_confirm]]",function(e){bootbox.confirm(e,function(e){if(!e){return}socket.emit("groups.kick",{uid:o,groupName:c},function(e){if(!e){a.slideUp().remove()}else{app.alertError(e.message)}})})});break;case"update":s.update();break;case"delete":s.deleteGroup();break;case"join":case"leave":case"accept":case"reject":case"issueInvite":case"rescindInvite":case"acceptInvite":case"rejectInvite":case"acceptAll":case"rejectAll":socket.emit("groups."+i,{toUid:o,groupName:c},function(e){if(!e){ajaxify.refresh()}else{app.alertError(e.message)}});break}})};s.prepareSettings=function(){var a=p.get("groups/settings");var e=a.find('[data-action="color-select"]');var r=a.find('[name="labelColor"]');var t=a.find('[data-action="icon-select"]');var o=a.find(".label");var i=o.find("i");var n=a.find('[name="userTitle"]');var s=a.find('[name="userTitleEnabled"]');var c=a.find('[name="icon"]');e.ColorPicker({color:r.val()||"#000",onChange:function(e,a){r.val("#"+a);o.css("background-color","#"+a)},onShow:function(e){$(e).css("z-index",1051)}});t.on("click",function(){u.init(i,function(){c.val(i.val())})});n.on("keyup",function(){var e=i.detach();o.text(" "+(this.value||a.find("#name").val()));o.prepend(e)});s.on("change",function(){var e=p.get("groups/userTitleOption");if(this.checked){e.removeAttr("disabled");o.removeClass("hide")}else{e.attr("disabled","disabled");o.addClass("hide")}})};s.update=function(){var e=p.get("groups/settings");var a=e.find('input[type="checkbox"][name]');if(e.length){require(["vendor/jquery/serializeObject/jquery.ba-serializeobject.min"],function(){var r=e.serializeObject();a.each(function(e,a){a=$(a);if(a.length){r[a.attr("name")]=a.prop("checked")}});socket.emit("groups.update",{groupName:c,values:r},function(e){if(e){return app.alertError(e.message)}if(r.name){var a=window.location.pathname;a=a.substr(1,a.lastIndexOf("/"));ajaxify.go(a+utils.slugify(r.name))}else{ajaxify.refresh()}app.alertSuccess("[[groups:event.updated]]")})})}};s.deleteGroup=function(){bootbox.confirm("Are you sure you want to delete the group: "+utils.escapeHTML(c),function(e){if(e){bootbox.prompt("Please enter the name of this group in order to delete it:",function(e){if(e===c){socket.emit("groups.delete",{groupName:c},function(e){if(!e){app.alertSuccess("[[groups:event.deleted, "+utils.escapeHTML(c)+"]]");ajaxify.go("groups")}else{app.alertError(e.message)}})}})}})};function o(){if(!ajaxify.data.group.isOwner){return}var a=$('[component="groups/members/invite"]');require(["autocomplete"],function(e){e.user(a,function(e,a){socket.emit("groups.issueInvite",{toUid:a.item.user.uid,groupName:ajaxify.data.group.name},function(e){if(e){return app.alertError(e.message)}ajaxify.refresh()})})});$('[component="groups/members/bulk-invite-button"]').on("click",function(){var e=$('[component="groups/members/bulk-invite"]').val();if(!e){return false}socket.emit("groups.issueMassInvite",{usernames:e,groupName:ajaxify.data.group.name},function(e){if(e){return app.alertError(e.message)}ajaxify.refresh()});return false})}function i(){n.translate("[[groups:remove_group_cover_confirm]]",function(e){bootbox.confirm(e,function(e){if(!e){return}socket.emit("groups.cover.remove",{groupName:ajaxify.data.group.name},function(e){if(!e){ajaxify.refresh()}else{app.alertError(e.message)}})})})}return s});
//# sourceMappingURL=public/src/client/groups/details.js.map