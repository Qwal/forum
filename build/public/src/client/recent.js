"use strict";define("forum/recent",["forum/infinitescroll","components"],function(t,n){var i={};var a=0;var o=0;$(window).on("action:ajaxify.start",function(e,t){if(ajaxify.currentPage!==t.url){i.removeListeners()}});i.init=function(){app.enterRoom("recent_topics");i.watchForNewPosts();i.handleCategorySelection();$("#new-topics-alert").on("click",function(){$(this).addClass("hide")});if(!config.usePagination){t.init(i.loadMoreTopics)}$(window).trigger("action:topics.loaded",{topics:ajaxify.data.topics})};i.watchForNewPosts=function(){o=0;a=0;i.removeListeners();socket.on("event:new_topic",e);socket.on("event:new_post",c)};function e(e){if(ajaxify.data.selectedCids&&ajaxify.data.selectedCids.indexOf(parseInt(e.cid,10))===-1){return}if(ajaxify.data.selectedFilter&&ajaxify.data.selectedFilter.filter==="watched"){return}if(ajaxify.data.template.category&&parseInt(ajaxify.data.cid,10)!==parseInt(e.cid,10)){return}a+=1;i.updateAlertText()}function c(e){function a(){o+=1;i.updateAlertText()}var t=e.posts[0];if(!t||!t.topic){return}if(parseInt(t.topic.mainPid,10)===parseInt(t.pid,10)){return}if(ajaxify.data.selectedCids&&ajaxify.data.selectedCids.indexOf(parseInt(t.topic.cid,10))===-1){return}if(ajaxify.data.selectedFilter&&ajaxify.data.selectedFilter.filter==="new"){return}if(ajaxify.data.template.category&&parseInt(ajaxify.data.cid,10)!==parseInt(t.topic.cid,10)){return}if(ajaxify.data.selectedFilter&&ajaxify.data.selectedFilter.filter==="watched"){socket.emit("topics.isFollowed",t.tid,function(e,t){if(e){app.alertError(e.message)}if(t){a()}});return}a()}i.handleCategorySelection=function(){function n(){var a=[];$('[component="category/list"] [data-cid]').each(function(e,t){if($(t).find("i.fa-check").length){a.push(parseInt($(t).attr("data-cid"),10))}});a.sort(function(e,t){return e-t});return a}$('[component="category/dropdown"]').on("hidden.bs.dropdown",function(){var a=n();var i=ajaxify.data.selectedCids.length!==a.length;ajaxify.data.selectedCids.forEach(function(e,t){if(e!==a[t]){i=true}});if(i){var e=ajaxify.data.selectedFilter.url;if(a.length){e+="?"+decodeURIComponent($.param({cid:a}))}ajaxify.go(e)}});$('[component="category/list"]').on("click","[data-cid]",function(e){function i(e,a){$('[component="category/list"] [data-parent-cid="'+e+'"] [component="category/select/icon"]').toggleClass("fa-check",a);$('[component="category/list"] [data-parent-cid="'+e+'"]').each(function(e,t){i($(t).attr("data-cid"),a)})}var t=$(this);var a=$(this).attr("data-cid");if(e.ctrlKey){i(a,!t.find('[component="category/select/icon"]').hasClass("fa-check"))}t.find('[component="category/select/icon"]').toggleClass("fa-check");$('[component="category/list"] li').first().find("i").toggleClass("fa-check",!n().length);return false})};i.removeListeners=function(){socket.removeListener("event:new_topic",e);socket.removeListener("event:new_post",c)};i.updateAlertText=function(){var e="";if(a===0){if(o===1){e="[[recent:there-is-a-new-post]]"}else if(o>1){e="[[recent:there-are-new-posts, "+o+"]]"}}else if(a===1){if(o===0){e="[[recent:there-is-a-new-topic]]"}else if(o===1){e="[[recent:there-is-a-new-topic-and-a-new-post]]"}else if(o>1){e="[[recent:there-is-a-new-topic-and-new-posts, "+o+"]]"}}else if(a>1){if(o===0){e="[[recent:there-are-new-topics, "+a+"]]"}else if(o===1){e="[[recent:there-are-new-topics-and-a-new-post, "+a+"]]"}else if(o>1){e="[[recent:there-are-new-topics-and-new-posts, "+a+", "+o+"]]"}}e+=" [[recent:click-here-to-reload]]";$("#new-topics-alert").translateText(e).removeClass("hide").fadeIn("slow");$("#category-no-topics").addClass("hide")};i.loadMoreTopics=function(e){if(e<0||!$('[component="category"]').length){return}t.loadMore("topics.loadMoreRecentTopics",{after:$('[component="category"]').attr("data-nextstart"),count:config.topicsPerPage,cid:utils.params().cid,filter:ajaxify.data.selectedFilter.filter,set:$('[component="category"]').attr("data-set")?$('[component="category"]').attr("data-set"):"topics:recent"},function(e,t){if(e.topics&&e.topics.length){i.onTopicsLoaded("recent",e.topics,false,t)}else{t()}$('[component="category"]').attr("data-nextstart",e.nextStart)})};i.onTopicsLoaded=function(e,t,a,i){t=t.filter(function(e){return!n.get("category/topic","tid",e.tid).length});if(!t.length){return i()}app.parseAndTranslate(e,"topics",{topics:t,showSelect:a},function(e){$("#category-no-topics").remove();e.insertAfter($('[component="category/topic"]').last());e.find(".timeago").timeago();app.createUserTooltips();utils.makeNumbersHumanReadable(e.find(".human-readable-number"));$(window).trigger("action:topics.loaded",{topics:t});i()})};return i});
//# sourceMappingURL=public/src/client/recent.js.map