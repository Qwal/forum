"use strict";define("forum/register",["translator","zxcvbn"],function(o,i){var e={};var l=false;var t="";e.init=function(){var r=$("#email");var a=$("#username");var s=$("#password");var n=$("#password-confirm");var e=$("#register");g();$("#referrer").val(app.previousUrl);$("#content #noscript").val("false");r.on("blur",function(){if(r.val().length){f(r.val())}});var i=utils.params();if(i.email&&i.token){r.val(decodeURIComponent(i.email));$("#token").val(i.token)}a.on("keyup",function(){$("#yourUsername").text(this.value.length>0?utils.slugify(this.value):"username")});a.on("blur",function(){if(a.val().length){u(a.val())}});s.on("blur",function(){if(s.val().length){c(s.val(),n.val())}});n.on("blur",function(){if(n.val().length){m(s.val(),n.val())}});function t(e){l=false;c(s.val(),n.val());m(s.val(),n.val());f(r.val(),function(){u(a.val(),e)})}e.on("click",function(e){var n=$(this);var a=$("#register-error-notify");a.addClass("hidden");e.preventDefault();t(function(){if(l){return}n.addClass("disabled");n.parents("form").ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},success:function(e){n.removeClass("disabled");if(!e){return}if(e.referrer){var r=utils.urlToLocation(e.referrer).pathname;var a=utils.params({url:e.referrer});a.registered=true;var s=decodeURIComponent($.param(a));window.location.href=r+"?"+s}else if(e.message){o.translate(e.message,function(e){bootbox.alert(e);ajaxify.go("/")})}},error:function(r){o.translate(r.responseText,config.defaultLang,function(e){if(r.status===403&&r.responseText==="Forbidden"){window.location.href=config.relative_path+"/register?error=csrf-invalid"}else{a.find("p").text(e);a.removeClass("hidden");n.removeClass("disabled")}})}})})})};function f(e,a){a=a||function(){};var s=$("#email-notify");if(!utils.isEmailValid(e)){d(s,"[[error:invalid-email]]");return a()}socket.emit("user.emailExists",{email:e},function(e,r){if(e){app.alertError(e.message);return a()}if(r){d(s,"[[error:email-taken]]")}else{v(s,t)}a()})}function u(e,a){a=a||function(){};var s=$("#username-notify");if(e.length<ajaxify.data.minimumUsernameLength){d(s,"[[error:username-too-short]]")}else if(e.length>ajaxify.data.maximumUsernameLength){d(s,"[[error:username-too-long]]")}else if(!utils.isUserNameValid(e)||!utils.slugify(e)){d(s,"[[error:invalid-username]]")}else{socket.emit("user.exists",{username:e},function(e,r){if(e){return app.alertError(e.message)}if(r){d(s,"[[error:username-taken]]")}else{v(s,t)}a()})}}function c(e,r){var a=$("#password-notify");var s=$("#password-confirm-notify");var n=i(e);if(e.length<ajaxify.data.minimumPasswordLength){d(a,"[[user:change_password_error_length]]")}else if(e.length>4096){d(a,"[[error:password-too-long]]")}else if(!utils.isPasswordValid(e)){d(a,"[[user:change_password_error]]")}else if(e===$("#username").val()){d(a,"[[user:password_same_as_username]]")}else if(e===$("#email").val()){d(a,"[[user:password_same_as_email]]")}else if(n.score<ajaxify.data.minimumPasswordStrength){d(a,"[[user:weak_password]]")}else{v(a,t)}if(e!==r&&r!==""){d(s,"[[user:change_password_error_match]]")}}function m(e,r){var a=$("#password-notify");var s=$("#password-confirm-notify");if(!e||a.hasClass("alert-error")){return}if(e!==r){d(s,"[[user:change_password_error_match]]")}else{v(s,t)}}function d(r,e){o.translate(e,function(e){r.html(e);r.parent().removeClass("register-success").addClass("register-danger");r.show()});l=true}function v(r,e){o.translate(e,function(e){r.html(e);r.parent().removeClass("register-danger").addClass("register-success");r.show()})}function g(){if(!app.user.uid&&config.defaultLang!==config.userLang){var e=$('[component="register/local"]');var r=$('<input type="hidden" name="userLang" value="'+config.userLang+'" />');e.append(r)}}return e});
//# sourceMappingURL=public/src/client/register.js.map