"use strict";define("forum/chats/messages",["components","sounds","translator","benchpress"],function(s,r,o,a){var n={};n.sendMessage=function(e,t){var a=t.val();var s=t.attr("data-mid");if(a.length>ajaxify.data.maximumChatMessageLength){return app.alertError("[[error:chat-message-too-long,"+ajaxify.data.maximumChatMessageLength+"]]")}if(!a.length){return}t.val("");t.removeAttr("data-mid");$(window).trigger("action:chat.sent",{roomId:e,message:a,mid:s});if(!s){socket.emit("modules.chats.send",{roomId:e,message:a},function(e){if(e){t.val(a);if(e.message==="[[error:email-not-confirmed-chat]]"){return app.showEmailConfirmWarning(e)}return app.alert({alert_id:"chat_spam_error",title:"[[global:alert.error]]",message:e.message,type:"danger",timeout:1e4})}r.play("chat-outgoing")})}else{socket.emit("modules.chats.edit",{roomId:e,mid:s,message:a},function(e){if(e){t.val(a);t.attr("data-mid",s);return app.alertError(e.message)}})}};n.appendChatMessage=function(t,e){var a=parseInt(t.find(".chat-message").last().attr("data-uid"),10);var s=parseInt(t.find(".chat-message").last().attr("data-timestamp"),10);if(!Array.isArray(e)){e.newSet=a!==parseInt(e.fromuid,10)||parseInt(e.timestamp,10)>parseInt(s,10)+1e3*60*3}n.parseMessage(e,function(e){i(t,e)})};function i(e,t){var a=$(t);a.appendTo(e);a.find(".timeago").timeago();a.find("img:not(.not-responsive)").addClass("img-responsive");n.scrollToBottom(e);$(window).trigger("action:chat.received",{messageEl:a})}n.parseMessage=function(e,t){a.parse("partials/chats/message"+(Array.isArray(e)?"s":""),{messages:e},function(e){o.translate(e,t)})};n.scrollToBottom=function(e){if(e.length){e.scrollTop(e[0].scrollHeight-e.height())}};n.prepEdit=function(a,s,e){socket.emit("modules.chats.getRaw",{mid:s,roomId:e},function(e,t){if(e){return app.alertError(e.message)}if(a.val().length===0){a.attr("data-mid",s).addClass("editing");a.val(t)}})};n.onChatMessageEdit=function(){socket.on("event:chats.edit",function(e){e.messages.forEach(function(a){var e=parseInt(a.fromuid,10)===parseInt(app.user.uid,10);a.self=e?1:0;n.parseMessage(a,function(e){var t=s.get("chat/message",a.messageId);if(t.length){t.replaceWith(e);s.get("chat/message",a.messageId).find(".timeago").timeago()}})})})};n.delete=function(t,a){o.translate("[[modules:chat.delete_message_confirm]]",function(e){bootbox.confirm(e,function(e){if(!e){return}socket.emit("modules.chats.delete",{messageId:t,roomId:a},function(e){if(e){return app.alertError(e.message)}s.get("chat/message",t).toggleClass("deleted",true)})})})};n.restore=function(t,e){socket.emit("modules.chats.restore",{messageId:t,roomId:e},function(e){if(e){return app.alertError(e.message)}s.get("chat/message",t).toggleClass("deleted",false)})};return n});
//# sourceMappingURL=public/src/client/chats/messages.js.map