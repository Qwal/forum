"use strict";define("forum/category/tools",["forum/topic/move","forum/topic/merge","topicSelect","components","translator"],function(o,e,r,c,n){var i={};i.init=function(t){i.cid=t;r.init(a);L();c.get("topic/delete").on("click",function(){s("delete",r.getSelectedTids());return false});c.get("topic/restore").on("click",function(){s("restore",r.getSelectedTids());return false});c.get("topic/purge").on("click",function(){s("purge",r.getSelectedTids());return false});c.get("topic/lock").on("click",function(){var e=r.getSelectedTids();if(!e.length){return app.alertError("[[error:no-topics-selected]]")}socket.emit("topics.lock",{tids:e,cid:i.cid},l);return false});c.get("topic/unlock").on("click",function(){var e=r.getSelectedTids();if(!e.length){return app.alertError("[[error:no-topics-selected]]")}socket.emit("topics.unlock",{tids:e,cid:i.cid},l);return false});c.get("topic/pin").on("click",function(){var e=r.getSelectedTids();if(!e.length){return app.alertError("[[error:no-topics-selected]]")}socket.emit("topics.pin",{tids:e,cid:i.cid},l);return false});c.get("topic/unpin").on("click",function(){var e=r.getSelectedTids();if(!e.length){return app.alertError("[[error:no-topics-selected]]")}socket.emit("topics.unpin",{tids:e,cid:i.cid},l);return false});c.get("topic/mark-unread-for-all").on("click",function(){var t=r.getSelectedTids();if(!t.length){return app.alertError("[[error:no-topics-selected]]")}socket.emit("topics.markAsUnreadForAll",t,function(e){if(e){return app.alertError(e.message)}app.alertSuccess("[[topic:markAsUnreadForAll.success]]");t.forEach(function(e){$('[component="category/topic"][data-tid="'+e+'"]').addClass("unread")});l()});return false});c.get("topic/move").on("click",function(){var e=r.getSelectedTids();if(!e.length){return app.alertError("[[error:no-topics-selected]]")}o.init(e,t,l);return false});c.get("topic/move-all").on("click",function(){o.init(null,t,function(e){if(e){return app.alertError(e.message)}ajaxify.refresh()})});e.init();i.removeListeners();socket.on("event:topic_deleted",m);socket.on("event:topic_restored",m);socket.on("event:topic_purged",E);socket.on("event:topic_locked",_);socket.on("event:topic_unlocked",_);socket.on("event:topic_pinned",h);socket.on("event:topic_unpinned",h);socket.on("event:topic_moved",C)};function s(t,o){if(!o.length){return app.alertError("[[error:no-topics-selected]]")}n.translate("[[topic:thread_tools."+t+"_confirm]]",function(e){bootbox.confirm(e,function(e){if(!e){return}socket.emit("topics."+t,{tids:o,cid:i.cid},d)})})}i.removeListeners=function(){socket.removeListener("event:topic_deleted",m);socket.removeListener("event:topic_restored",m);socket.removeListener("event:topic_purged",E);socket.removeListener("event:topic_locked",_);socket.removeListener("event:topic_unlocked",_);socket.removeListener("event:topic_pinned",h);socket.removeListener("event:topic_unpinned",h);socket.removeListener("event:topic_moved",C)};function t(){$(".thread-tools.open").find(".dropdown-toggle").trigger("click")}function l(e){if(e){return app.alertError(e.message)}t();r.unselectAll()}function d(e){if(e){return app.alertError(e.message)}t();a()}function a(){var e=r.getSelectedTids();var t=p(f,e);var o=u(f,e);var n=p(v,e);var i=p(g,e);c.get("topic/delete").toggleClass("hidden",t);c.get("topic/restore").toggleClass("hidden",!t);c.get("topic/purge").toggleClass("hidden",!o);c.get("topic/lock").toggleClass("hidden",i);c.get("topic/unlock").toggleClass("hidden",!i);c.get("topic/pin").toggleClass("hidden",n);c.get("topic/unpin").toggleClass("hidden",!n)}function p(e,t){for(var o=0;o<t.length;o+=1){if(e(t[o])){return true}}return false}function u(e,t){for(var o=0;o<t.length;o+=1){if(!e(t[o])){return false}}return true}function f(e){return k(e).hasClass("deleted")}function g(e){return k(e).hasClass("locked")}function v(e){return k(e).hasClass("pinned")}function k(e){return c.get("category/topic","tid",e)}function m(e){var t=k(e.tid);t.toggleClass("deleted",e.isDeleted);t.find('[component="topic/locked"]').toggleClass("hide",!e.isDeleted)}function h(e){var t=k(e.tid);t.toggleClass("pinned",e.isPinned);t.find('[component="topic/pinned"]').toggleClass("hide",!e.isPinned);ajaxify.refresh()}function _(e){var t=k(e.tid);t.toggleClass("locked",e.isLocked);t.find('[component="topic/locked"]').toggleClass("hide",!e.isLocked)}function C(e){k(e.tid).remove()}function E(e){k(e.tid).remove()}function L(){var e=utils.findBootstrapEnvironment();if(!ajaxify.data.privileges.isAdminOrMod||e==="xs"||e==="sm"){return}app.loadJQueryUI(function(){$('[component="category"]').sortable({items:'[component="category/topic"].pinned',update:function(){var o=[];var n=$('[component="category/topic"].pinned');n.each(function(e,t){o.push({tid:$(t).attr("data-tid"),order:n.length-e-1})});socket.emit("topics.orderPinnedTopics",o,function(e){if(e){return app.alertError(e.message)}})}})})}return i});
//# sourceMappingURL=public/src/client/category/tools.js.map