"use strict";define("forum/topic/images",["forum/topic/postTools","navigator","components"],function(t,a,l){var u={_imageLoaderTimeout:undefined};u.unloadImages=function(t){var a=t.find('[component="post/content"] img:not(.not-responsive)');if(config.delayImageLoading){a.each(function(){$(this).attr("data-src",$(this).attr("src"))}).attr("data-state","unloaded").attr("src","about:blank")}else{a.attr("data-state","loaded");u.wrapImagesInLinks(t);$(window).trigger("action:images.loaded")}};u.loadImages=function(c){if(u._imageLoaderTimeout){clearTimeout(u._imageLoaderTimeout)}if(!config.delayImageLoading){return}u._imageLoaderTimeout=setTimeout(function(){var t=l.get("post/content").find('img[data-state="unloaded"]');var a=t.filter(function(){return utils.isElementInViewport(this)});var e=$.unique(a.map(function(){return $(this).parents('[component="post"]').get(0)}));var i=$(window).scrollTop();var n=false;var o=[];var r;var s;function d(){n=true;r=document.body.clientHeight;$(this).attr("data-state","loaded");s=document.body.clientHeight;var t=this.getBoundingClientRect();if(t.top<c){i+=s-r;$(window).scrollTop(i)}if(o.length){o.pop()()}else{n=false;u.wrapImagesInLinks(e);$(window).trigger("action:images.loaded");e.length=0}}a.attr("data-state","loading");a.each(function(t,a){a=$(a);a.on("load",function(){if(!n){d.call(this)}else{o.push(d.bind(this))}});a.attr("src",a.attr("data-src"));a.removeAttr("data-src")})},250)};u.wrapImagesInLinks=function(t){t.find('[component="post/content"] img:not(.emoji)').each(function(){var t=$(this);var a=t.attr("src")||"";var e=t.attr("alt")||"";var i=/-resized(\.[\w]+)?$/;if(a==="about:blank"){return}if(utils.isRelativeUrl(a)&&i.test(a)){a=a.replace(i,"$1")}var n=a.split(".").slice(1).pop();var o=e.split("/").pop();var r=o.split(".").slice(1).pop();if(!t.parent().is("a")){t.wrap('<a href="'+a+'" '+(!n&&r?' download="'+o+'" ':"")+' target="_blank" >')}})};return u});
//# sourceMappingURL=public/src/client/topic/images.js.map