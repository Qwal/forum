"use strict";define("forum/topic/events",["forum/topic/postTools","forum/topic/threadTools","forum/topic/posts","forum/topic/images","components","translator","benchpress"],function(a,t,o,p,r,d,c){var e={};var n={"event:user_status_change":i,"event:voted":s,"event:bookmarked":u,"event:topic_deleted":t.setDeleteState,"event:topic_restored":t.setDeleteState,"event:topic_purged":l,"event:topic_locked":t.setLockedState,"event:topic_unlocked":t.setLockedState,"event:topic_pinned":t.setPinnedState,"event:topic_unpinned":t.setPinnedState,"event:topic_moved":f,"event:post_edited":g,"event:post_purged":v,"event:post_deleted":k,"event:post_restored":k,"posts.bookmark":h,"posts.unbookmark":h,"posts.upvote":I,"posts.downvote":I,"posts.unvote":I,"event:new_notification":w,"event:new_post":o.onNewPost};e.init=function(){e.removeListeners();for(var t in n){if(n.hasOwnProperty(t)){socket.on(t,n[t])}}};e.removeListeners=function(){for(var t in n){if(n.hasOwnProperty(t)){socket.removeListener(t,n[t])}}};function i(t){app.updateUserStatus($('[data-uid="'+t.uid+'"] [component="user/status"]'),t.status)}function s(o){var t=$('[data-pid="'+o.post.pid+'"] [component="post/vote-count"]').filter(function(t,e){return parseInt($(e).closest("[data-pid]").attr("data-pid"),10)===parseInt(o.post.pid,10)});var e=$('.reputation[data-uid="'+o.post.uid+'"]');t.html(o.post.votes).attr("data-votes",o.post.votes);e.html(o.user.reputation).attr("data-reputation",o.user.reputation)}function u(o){$('[data-pid="'+o.post.pid+'"] .bookmarkCount').filter(function(t,e){return parseInt($(e).closest("[data-pid]").attr("data-pid"),10)===parseInt(o.post.pid,10)}).html(o.post.bookmarks).attr("data-bookmarks",o.post.bookmarks)}function l(){if(ajaxify.data.category&&ajaxify.data.category.slug){ajaxify.go("category/"+ajaxify.data.category.slug,null,true)}}function f(t){if(t&&t.slug){ajaxify.go("topic/"+t.slug,null,true)}}function g(o){if(!o||!o.post){return}var e=r.get("post/content",o.post.pid).filter(function(t,e){return parseInt($(e).closest("[data-pid]").attr("data-pid"),10)===parseInt(o.post.pid,10)});var a=$('[data-pid="'+o.post.pid+'"] [component="post/editor"]').filter(function(t,e){return parseInt($(e).closest("[data-pid]").attr("data-pid"),10)===parseInt(o.post.pid,10)});var t=r.get("topic/title");var n=r.get("navbar/title").find("span");var i=r.get("breadcrumb/current");if(t.length&&o.topic.title&&t.html()!==o.topic.title){ajaxify.data.title=o.topic.title;var s="topic/"+o.topic.slug+(window.location.search?window.location.search:"");history.replaceState({url:s},null,window.location.protocol+"//"+window.location.host+config.relative_path+"/"+s);t.fadeOut(250,function(){t.html(o.topic.title).fadeIn(250)});i.fadeOut(250,function(){i.html(o.topic.title).fadeIn(250)});n.fadeOut(250,function(){n.html(o.topic.title).fadeIn(250)})}e.fadeOut(250,function(){e.html(d.unescape(o.post.content));e.find("img:not(.not-responsive)").addClass("img-responsive");app.replaceSelfLinks(e.find("a"));p.wrapImagesInLinks(e.parent());p.unloadImages(e.parent());p.loadImages();e.fadeIn(250);var t={editor:o.editor,editedISO:utils.toISOString(o.post.edited)};c.parse("partials/topic/post-editor",t,function(e){d.translate(e,function(t){e=$(t);a.replaceWith(e);$('[data-pid="'+o.post.pid+'"] [component="post/editor"] .timeago').timeago();$(window).trigger("action:posts.edited",o)})})});if(o.topic.tags&&m(o.topic.tags)){c.parse("partials/post_bar","tags",{tags:o.topic.tags},function(t){var e=$(".tags");e.fadeOut(250,function(){e.html(t).fadeIn(250)})})}}function m(t){if(t.length!==$(".tags").first().children().length){return true}for(var e=0;e<t.length;e+=1){if(!$('.tags .tag-item[data-tag="'+t[e].value+'"]').length){return true}}return false}function v(e){r.get("post","pid",e.pid).fadeOut(500,function(){$(this).remove();o.showBottomPostBar()});ajaxify.data.postcount-=1;a.updatePostCount(ajaxify.data.postcount);require(["forum/topic/replies"],function(t){t.onPostPurged(e)})}function k(t){var e=r.get("post","pid",t.pid);if(!e.length){return}e.toggleClass("deleted");var o=e.hasClass("deleted");a.toggle(t.pid,o);if(!ajaxify.data.privileges.isAdminOrMod&&parseInt(t.uid,10)!==parseInt(app.user.uid,10)){e.find('[component="post/tools"]').toggleClass("hidden",o);if(o){e.find('[component="post/content"]').translateHtml("[[topic:post_is_deleted]]")}else{e.find('[component="post/content"]').html(d.unescape(t.content))}}}function h(o){var t=$('[data-pid="'+o.post.pid+'"] [component="post/bookmark"]').filter(function(t,e){return parseInt($(e).closest("[data-pid]").attr("data-pid"),10)===parseInt(o.post.pid,10)});if(!t.length){return}t.attr("data-bookmarked",o.isBookmarked);t.find('[component="post/bookmark/on"]').toggleClass("hidden",!o.isBookmarked);t.find('[component="post/bookmark/off"]').toggleClass("hidden",o.isBookmarked)}function I(o){var t=$('[data-pid="'+o.post.pid+'"]');t.find('[component="post/upvote"]').filter(function(t,e){return parseInt($(e).closest("[data-pid]").attr("data-pid"),10)===parseInt(o.post.pid,10)}).toggleClass("upvoted",o.upvote);t.find('[component="post/downvote"]').filter(function(t,e){return parseInt($(e).closest("[data-pid]").attr("data-pid"),10)===parseInt(o.post.pid,10)}).toggleClass("downvoted",o.downvote)}function w(t){var e=ajaxify.data.tid;if(t&&t.tid&&parseInt(t.tid,10)===parseInt(e,10)){socket.emit("topics.markTopicNotificationsRead",[e])}}return e});
//# sourceMappingURL=public/src/client/topic/events.js.map