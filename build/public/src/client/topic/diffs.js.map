{"version":3,"sources":["public/src/client/topic/diffs.js"],"names":["define","Images","Benchpress","translator","Diffs","open","pid","localeStringOpts","year","month","day","hour","minute","socket","emit","err","timestamps","app","alertError","message","parse","diffs","map","timestamp","parseInt","pretty","Date","toLocaleString","config","userLang","replace","numDiffs","length","html","translate","modal","bootbox","dialog","title","size","selectEl","find","postContainer","on","load","this","value","val","since","data","deleted","parseAndTranslate","posts","empty","append","unloadImages","loadImages"],"mappings":"AAAA,aAEAA,OAAO,qBAAsB,qBAAsB,aAAc,cAAe,SAAUC,EAAQC,EAAYC,GAC7G,IAAIC,KAEJA,EAAMC,KAAO,SAAUC,GACtB,IAAIC,GAAqBC,KAAM,UAAWC,MAAO,QAASC,IAAK,UAAWC,KAAM,UAAWC,OAAQ,WAEnGC,OAAOC,KAAK,kBAAoBR,IAAKA,GAAO,SAAUS,EAAKC,GAC1D,GAAID,EAAK,CACR,OAAOE,IAAIC,WAAWH,EAAII,SAG3BjB,EAAWkB,MAAM,gCAChBC,MAAOL,EAAWM,IAAI,SAAUC,GAC/BA,EAAYC,SAASD,EAAW,IAEhC,OACCA,UAAWA,EACXE,OAAQ,IAAIC,KAAKH,GAAWI,eAAeC,OAAOC,SAASC,QAAQ,IAAK,KAAMvB,MAGhFwB,SAAUf,EAAWgB,QACnB,SAAUC,GACZ9B,EAAW+B,UAAUD,EAAM,SAAUA,GACpC,IAAIE,EAAQC,QAAQC,QACnBC,MAAO,wBACPnB,QAASc,EACTM,KAAM,UAGP,IAAKvB,EAAWgB,OAAQ,CACvB,OAGD,IAAIQ,EAAWL,EAAMM,KAAK,UAC1B,IAAIC,EAAgBP,EAAMM,KAAK,iBAE/BD,EAASG,GAAG,SAAU,WACrBvC,EAAMwC,KAAKtC,EAAKuC,KAAKC,MAAOJ,KAG7BP,EAAMQ,GAAG,iBAAkB,WAC1BvC,EAAMwC,KAAKtC,EAAKkC,EAASO,MAAOL,YAOrCtC,EAAMwC,KAAO,SAAUtC,EAAK0C,EAAON,GAClC7B,OAAOC,KAAK,oBAAsBR,IAAKA,EAAK0C,MAAOA,GAAS,SAAUjC,EAAKkC,GAC1E,GAAIlC,EAAK,CACR,OAAOE,IAAIC,WAAWH,EAAII,SAG3B8B,EAAKC,UAAY1B,SAASyB,EAAKC,QAAS,IAExCjC,IAAIkC,kBAAkB,sBAAuB,SAC5CC,OAAQH,IACN,SAAUhB,GACZS,EAAcW,QAAQC,OAAOrB,GAC7BhC,EAAOsD,aAAatB,GACpBhC,EAAOuD,kBAKV,OAAOpD","file":"public/src/client/topic/diffs.js","sourcesContent":["'use strict';\n\ndefine('forum/topic/diffs', ['forum/topic/images', 'benchpress', 'translator'], function (Images, Benchpress, translator) {\n\tvar Diffs = {};\n\n\tDiffs.open = function (pid) {\n\t\tvar localeStringOpts = { year: 'numeric', month: 'short', day: 'numeric', hour: 'numeric', minute: 'numeric' };\n\n\t\tsocket.emit('posts.getDiffs', { pid: pid }, function (err, timestamps) {\n\t\t\tif (err) {\n\t\t\t\treturn app.alertError(err.message);\n\t\t\t}\n\n\t\t\tBenchpress.parse('partials/modals/post_history', {\n\t\t\t\tdiffs: timestamps.map(function (timestamp) {\n\t\t\t\t\ttimestamp = parseInt(timestamp, 10);\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\ttimestamp: timestamp,\n\t\t\t\t\t\tpretty: new Date(timestamp).toLocaleString(config.userLang.replace('_', '-'), localeStringOpts),\n\t\t\t\t\t};\n\t\t\t\t}),\n\t\t\t\tnumDiffs: timestamps.length,\n\t\t\t}, function (html) {\n\t\t\t\ttranslator.translate(html, function (html) {\n\t\t\t\t\tvar modal = bootbox.dialog({\n\t\t\t\t\t\ttitle: '[[topic:diffs.title]]',\n\t\t\t\t\t\tmessage: html,\n\t\t\t\t\t\tsize: 'large',\n\t\t\t\t\t});\n\n\t\t\t\t\tif (!timestamps.length) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar selectEl = modal.find('select');\n\t\t\t\t\tvar postContainer = modal.find('ul.posts-list');\n\n\t\t\t\t\tselectEl.on('change', function () {\n\t\t\t\t\t\tDiffs.load(pid, this.value, postContainer);\n\t\t\t\t\t});\n\n\t\t\t\t\tmodal.on('shown.bs.modal', function () {\n\t\t\t\t\t\tDiffs.load(pid, selectEl.val(), postContainer);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t};\n\n\tDiffs.load = function (pid, since, postContainer) {\n\t\tsocket.emit('posts.showPostAt', { pid: pid, since: since }, function (err, data) {\n\t\t\tif (err) {\n\t\t\t\treturn app.alertError(err.message);\n\t\t\t}\n\n\t\t\tdata.deleted = !!parseInt(data.deleted, 10);\n\n\t\t\tapp.parseAndTranslate('partials/posts_list', 'posts', {\n\t\t\t\tposts: [data],\n\t\t\t}, function (html) {\n\t\t\t\tpostContainer.empty().append(html);\n\t\t\t\tImages.unloadImages(html);\n\t\t\t\tImages.loadImages();\n\t\t\t});\n\t\t});\n\t};\n\n\treturn Diffs;\n});\n"]}