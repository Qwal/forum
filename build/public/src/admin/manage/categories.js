"use strict";define("admin/manage/categories",["vendor/jquery/serializeObject/jquery.ba-serializeobject.min","translator","benchpress"],function(a,s,t){var r={};var c=-1;var d;r.init=function(){socket.emit("admin.categories.getAll",function(a,e){if(a){return app.alertError(a.message)}r.render(e)});$('button[data-action="create"]').on("click",r.throwCreateModal);$(".categories").on("click",'button[data-action="toggle"]',function(){var a=$(this);var e=a.attr("data-cid");var t=a.parents('li[data-cid="'+e+'"]');var i=t.hasClass("disabled");var n=t.find("li[data-cid]").map(function(){return $(this).attr("data-cid")}).get();r.toggle([e].concat(n),!i);return false});$(".categories").on("click",".toggle",function(){var a=$(this);a.find("i").toggleClass("fa-minus").toggleClass("fa-plus");a.closest("[data-cid]").find("> ul[data-cid]").toggleClass("hidden")});$("#collapse-all").on("click",function(){a(false)});$("#expand-all").on("click",function(){a(true)});function a(a){var e=$(".categories .toggle");e.find("i").toggleClass("fa-minus",a).toggleClass("fa-plus",!a);e.closest("[data-cid]").find("> ul[data-cid]").toggleClass("hidden",!a)}};r.throwCreateModal=function(){socket.emit("admin.categories.getNames",{},function(a,e){if(a){return app.alertError(a.message)}t.parse("admin/partials/categories/create",{categories:e},function(a){var e=bootbox.dialog({title:"[[admin/manage/categories:alert.create]]",message:a,buttons:{save:{label:"[[global:save]]",className:"btn-primary",callback:t}}});function t(){var a=e.find("form").serializeObject();a.description="";a.icon="fa-comments";r.create(a);e.modal("hide");return false}e.find("form").on("submit",t)})})};r.create=function(a){socket.emit("admin.categories.create",a,function(a,e){if(a){return app.alertError(a.message)}app.alert({alert_id:"category_created",title:"[[admin/manage/categories:alert.created]]",message:"[[admin/manage/categories:alert.create-success]]",type:"success",timeout:2e3});ajaxify.go("admin/manage/categories/"+e.cid)})};r.render=function(a){var e=$(".categories");if(!a||!a.length){s.translate("[[admin/manage/categories:alert.none-active]]",function(a){$("<div></div>").addClass("alert alert-info text-center").text(a).appendTo(e)})}else{d={};f(a,e,0)}};r.toggle=function(a,e){var t={};a.forEach(function(a){t[a]={disabled:e?1:0}});socket.emit("admin.categories.update",t,function(a){if(a){return app.alertError(a.message)}ajaxify.refresh()})};function l(a){c=a.to.dataset.cid}function g(a){var e=parseInt(c,10)!==-1;if(a.newIndex!=null&&parseInt(a.oldIndex,10)!==parseInt(a.newIndex,10)||e){var t=e?d[c]:d[a.from.dataset.cid];var i={};var n=0;var r=t.toArray();var o=r.length;for(n;n<o;n+=1){i[r[n]]={order:n+1}}if(e){i[a.item.dataset.cid].parentCid=c}c=-1;socket.emit("admin.categories.update",i)}}function f(i,n,r){var o=0;i.forEach(function(e,a,t){s.translate(e.name,function(a){if(e.name!==a){e.name=a}o+=1;if(o===t.length){c()}})});if(!i.length){c()}function c(){t.parse("admin/partials/categories/category-rows",{cid:r,categories:i},function(a){s.translate(a,function(a){n.append(a);for(var e=0,t=i.length;e<t;e+=1){f(i[e].children,$('li[data-cid="'+i[e].cid+'"]'),i[e].cid)}d[r]=Sortable.create($('ul[data-cid="'+r+'"]')[0],{group:"cross-categories",animation:150,handle:".icon",dataIdAttr:"data-cid",ghostClass:"placeholder",onAdd:l,onEnd:g})})})}}return r});
//# sourceMappingURL=public/src/admin/manage/categories.js.map