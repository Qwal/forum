"use strict";define("admin/manage/privileges",["autocomplete","translator","benchpress","categorySelector"],function(i,a,t,e){var s={};var o;s.init=function(){o=ajaxify.data.cid||0;$("#category-selector").on("change",function(){var e=$(this).val();ajaxify.go("admin/manage/privileges/"+(e==="global"?"":$(this).val()))});s.setupPrivilegeTable()};s.setupPrivilegeTable=function(){$(".privilege-table-container").on("change",'input[type="checkbox"]',function(){var i=$(this);var r=i.parent().attr("data-privilege");var a=i.prop("checked");var e=i.parents("tr");var t=e.attr("data-group-name")||e.attr("data-uid");var o=parseInt(e.attr("data-private")||0,10);var n=e.attr("data-group-name")!==undefined;if(t){if(n&&r==="groups:moderate"&&!o&&a){bootbox.confirm("[[admin/manage/categories:alert.confirm-moderate]]",function(e){if(e){s.setPrivilege(t,r,a,i)}else{i.prop("checked",!i.prop("checked"))}})}else{s.setPrivilege(t,r,a,i)}}else{app.alertError("[[error:invalid-data]]")}});$(".privilege-table-container").on("click",'[data-action="search.user"]',s.addUserToPrivilegeTable);$(".privilege-table-container").on("click",'[data-action="search.group"]',s.addGroupToPrivilegeTable);$(".privilege-table-container").on("click",'[data-action="copyToChildren"]',s.copyPrivilegesToChildren);$(".privilege-table-container").on("click",'[data-action="copyPrivilegesFrom"]',s.copyPrivilegesFromCategory);s.exposeAssumedPrivileges()};s.refreshPrivilegeTable=function(){socket.emit("admin.categories.getPrivilegeSettings",o,function(e,i){if(e){return app.alertError(e.message)}var r=o?"admin/partials/categories/privileges":"admin/partials/global/privileges";t.parse(r,{privileges:i},function(e){a.translate(e,function(e){$(".privilege-table-container").html(e);s.exposeAssumedPrivileges()})})})};s.exposeAssumedPrivileges=function(){var r=[];$('.privilege-table tr[data-group-name="registered-users"] td input[type="checkbox"]').parent().each(function(e,i){if($(i).find("input").prop("checked")){r.push(i.getAttribute("data-privilege"))}});for(var e=0,i=r.length;e<i;e+=1){var a=$('.privilege-table tr[data-group-name]:not([data-group-name="registered-users"],[data-group-name="guests"]) td[data-privilege="'+r[e]+'"] input');a.each(function(e,i){if(!i.checked){i.indeterminate=true}})}};s.setPrivilege=function(e,i,r,a){socket.emit("admin.categories.setPrivilege",{cid:o,privilege:i,set:r,member:e},function(e){if(e){return app.alertError(e.message)}a.replaceWith('<i class="fa fa-spin fa-spinner"></i>');s.refreshPrivilegeTable()})};s.addUserToPrivilegeTable=function(){var a=bootbox.dialog({title:"[[admin/manage/categories:alert.find-user]]",message:'<input class="form-control input-lg" placeholder="[[admin/manage/categories:alert.user-search]]" />',show:true});a.on("shown.bs.modal",function(){var e=a.find("input");i.user(e,function(e,i){var r=o?["find","read","topics:read"]:["chat"];socket.emit("admin.categories.setPrivilege",{cid:o,privilege:r,set:true,member:i.item.user.uid},function(e){if(e){return app.alertError(e.message)}s.refreshPrivilegeTable();a.modal("hide")})})})};s.addGroupToPrivilegeTable=function(){var a=bootbox.dialog({title:"[[admin/manage/categories:alert.find-group]]",message:'<input class="form-control input-lg" placeholder="[[admin/manage/categories:alert.group-search]]" />',show:true});a.on("shown.bs.modal",function(){var e=a.find("input");i.group(e,function(e,i){var r=o?["groups:find","groups:read","groups:topics:read"]:["groups:chat"];socket.emit("admin.categories.setPrivilege",{cid:o,privilege:r,set:true,member:i.item.group.name},function(e){if(e){return app.alertError(e.message)}s.refreshPrivilegeTable();a.modal("hide")})})})};s.copyPrivilegesToChildren=function(){socket.emit("admin.categories.copyPrivilegesToChildren",o,function(e){if(e){return app.alertError(e.message)}app.alertSuccess("Privileges copied!")})};s.copyPrivilegesFromCategory=function(){e.modal(function(e){socket.emit("admin.categories.copyPrivilegesFrom",{toCid:o,fromCid:e},function(e){if(e){return app.alertError(e.message)}ajaxify.refresh()})})};return s});
//# sourceMappingURL=public/src/admin/manage/privileges.js.map