"use strict";define("admin/manage/category",["uploader","iconSelect","admin/modules/colorpicker","autocomplete","translator","categorySelector"],function(e,t,i,a,n,r){var o={};var c={};o.init=function(){$("#category-settings select").each(function(){var a=$(this);a.val(a.attr("data-value"))});$("#category-selector").on("change",function(){ajaxify.go("admin/manage/categories/"+$(this).val()+window.location.hash)});function a(a,e){var t=$(e);var n=t.parents("[data-cid]").find(".category-preview");i.enable(t,function(a,e){if(t.attr("data-name")==="bgColor"){n.css("background-color","#"+e)}else if(t.attr("data-name")==="color"){n.css("color","#"+e)}s(t[0])})}d();$("#category-settings input, #category-settings select").not($(".privilege-table-container input")).on("change",function(a){s(a.target)}).on("keydown",function(a){if(a.which===13){a.preventDefault();return false}});$('[data-name="imageClass"]').on("change",function(){$(".category-preview").css("background-size",$(this).val())});$('[data-name="bgColor"], [data-name="color"]').each(a);$("#save").on("click",function(){if(Object.keys(c).length){socket.emit("admin.categories.update",c,function(a,e){if(a){return app.alertError(a.message)}if(e&&e.length){app.flags._unsaved=false;app.alert({title:"Updated Categories",message:"Category IDs "+e.join(", ")+" was successfully updated.",type:"success",timeout:2e3})}});c={}}return false});$(".purge").on("click",function(a){a.preventDefault();bootbox.confirm(n.compile("admin/manage/categories:alert.confirm-purge",$("form.category").find('input[data-name="name"]').val()),function(a){if(!a){return}socket.emit("admin.categories.purge",ajaxify.data.category.cid,function(a){if(a){return app.alertError(a.message)}app.alertSuccess("[[admin/manage/categories:alert.purge-success]]");ajaxify.go("admin/manage/categories")})})});$(".copy-settings").on("click",function(){r.modal(function(a){socket.emit("admin.categories.copySettingsFrom",{fromCid:a,toCid:ajaxify.data.category.cid},function(a){if(a){return app.alertError(a.message)}app.alertSuccess("[[admin/manage/categories:alert.copy-success]]");ajaxify.refresh()})});return false});$(".upload-button").on("click",function(){var t=$(this);var a=t.attr("data-cid");e.show({title:"[[admin/manage/categories:alert.upload-image]]",route:config.relative_path+"/api/admin/category/uploadpicture",params:{cid:a}},function(a){$("#category-image").val(a);var e=t.parent().parent().siblings(".category-preview");e.css("background","url("+a+"?"+(new Date).getTime()+")");s($("#category-image"))})});$("#category-image").on("change",function(){$(".category-preview").css("background-image",$(this).val()?'url("'+$(this).val()+'")':"")});$(".delete-image").on("click",function(a){a.preventDefault();var e=$("#category-image");var t=$(".category-preview");e.val("");t.css("background-image","");s(e[0]);$(this).parent().addClass("hide").hide()});$(".category-preview").on("click",function(){t.init($(this).find("i"),s)});$('[type="checkbox"]').on("change",function(){s($(this))});$('button[data-action="setParent"], button[data-action="changeParent"]').on("click",o.launchParentSelector);$('button[data-action="removeParent"]').on("click",function(){var a={};a[ajaxify.data.category.cid]={parentCid:0};socket.emit("admin.categories.update",a,function(a){if(a){return app.alertError(a.message)}$('button[data-action="removeParent"]').parent().addClass("hide");$('button[data-action="changeParent"]').parent().addClass("hide");$('button[data-action="setParent"]').removeClass("hide")})})};function s(a){var e=ajaxify.data.category.cid;if(e){var t;if($(a).is(":checkbox")){t=$(a).is(":checked")?1:0}else{t=$(a).val()}c[e]=c[e]||{};c[e][$(a).attr("data-name")]=t;app.flags=app.flags||{};app.flags._unsaved=true}}function d(){var e=$("#tag-whitelist");e.tagsinput({confirmKeys:[13,44],trimValue:true});ajaxify.data.category.tagWhitelist.forEach(function(a){e.tagsinput("add",a)});e.on("itemAdded itemRemoved",function(){s(e)})}o.launchParentSelector=function(){var a=ajaxify.data.allCategories.filter(function(a){return a&&!a.disabled&&parseInt(a.cid,10)!==parseInt(ajaxify.data.category.cid,10)});r.modal(a,function(n){var a={};a[ajaxify.data.category.cid]={parentCid:n};socket.emit("admin.categories.update",a,function(a){if(a){return app.alertError(a.message)}var e=ajaxify.data.allCategories.filter(function(a){return a&&parseInt(a.cid,10)===parseInt(n,10)});e=e[0];$('button[data-action="removeParent"]').parent().removeClass("hide");$('button[data-action="setParent"]').addClass("hide");var t='<i class="fa '+e.icon+'"></i> '+e.name;$('button[data-action="changeParent"]').html(t).parent().removeClass("hide")})})};return o});
//# sourceMappingURL=public/src/admin/manage/category.js.map