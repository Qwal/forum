"use strict";define("admin/modules/search",["mousetrap"],function(e){var t={};function o(e,i){var t=e.filter(function(e){return e.translations.toLowerCase().includes(i)}).map(function(e){var t=e.namespace;var s=e.translations;var a=e.title;var r=utils.escapeRegexChars(i);var n=s.replace(new RegExp("^(?:(?!"+r+").)*$","gmi"),"").replace(new RegExp("(^|\\n).*?"+a+".*?(\\n|$)","g"),"").replace(new RegExp("^[\\s\\S]*?(.{0,25})("+r+")(.{0,25})[\\s\\S]*?$","gmi"),'...$1<span class="search-match">$2</span>$3...<br>').replace(/(?:\n ?)+/g,"\n").trim();a=a.replace(new RegExp("(^.*?)("+r+")(.*?$)","gi"),'$1<span class="search-match">$2</span>$3');return'<li role="presentation" class="result">'+'<a role= "menuitem" href= "'+config.relative_path+"/"+t+'" >'+a+"<br>"+(!n?"":"<small><code>"+n+"</small></code>")+"</a>"+"</li>"}).join("");return t}t.init=function(){socket.emit("admin.getSearchDict",{},function(e,t){if(e){app.alertError(e);throw e}s(t)})};function s(a){var r=$("#acp-search .dropdown");var n=$("#acp-search .dropdown-menu");var i=$("#acp-search input");if(!config.searchEnabled){n.addClass("search-disabled")}i.on("keyup",function(){r.addClass("open")});$("#acp-search").parents("form").on("submit",function(e){var t=n.find("li.result > a.focus").attr("href");if(!t.length){t=n.find("li.result > a").first().attr("href")}var s=t||config.relative_path+"/search?in=titlesposts&term="+escape(i.val());ajaxify.go(s.replace(/^\//,""));setTimeout(function(){r.removeClass("open");i.blur()},150);e.preventDefault();return false});e(i[0]).bind(["up","down"],function(e,t){var s;if(t==="up"){s=n.find("li.result > a.focus").removeClass("focus").parent().prev(".result").children();if(!s.length){s=n.find("li.result > a").last()}s.addClass("focus");if(n[0].getBoundingClientRect().top>s[0].getBoundingClientRect().top){s[0].scrollIntoView(true)}}else if(t==="down"){s=n.find("li.result > a.focus").removeClass("focus").parent().next(".result").children();if(!s.length){s=n.find("li.result > a").first()}s.addClass("focus");if(n[0].getBoundingClientRect().bottom<s[0].getBoundingClientRect().bottom){s[0].scrollIntoView(false)}}e.preventDefault()});var l;i.on("keyup focus",function(){var e=i.val().toLowerCase();if(e===l){return}l=e;n.children(".result").remove();var t=/\W/.test(e)?3:e.length;var s;n.toggleClass("state-start-typing",t===0);n.toggleClass("state-keep-typing",t>0&&t<3);if(t>=3){n.prepend(o(a,e));s=n.children(".result").length;n.toggleClass("state-no-results",!s);n.toggleClass("state-yes-results",!!s);n.find(".search-forum").not(".divider").find("a").attr("href",config.relative_path+"/search?in=titlesposts&term="+escape(e)).find("strong").text(e)}else{n.removeClass("state-no-results state-yes-results")}})}return t});
//# sourceMappingURL=public/src/admin/modules/search.js.map