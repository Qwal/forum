"use strict";define("admin/extend/widgets",["jqueryui"],function(){var a={};a.init=function(){$("#widgets .nav-pills a").on("click",function(a){var t=$(this);$("#widgets .nav-pills li").removeClass("active");t.parent().addClass("active");$("#widgets .tab-pane").removeClass("active");$('#widgets .tab-pane[data-template="'+t.attr("data-template")+'"]').addClass("active");a.preventDefault();return false});$("#widget-selector").on("change",function(){$(".available-widgets [data-widget]").addClass("hide");$('.available-widgets [data-widget="'+$(this).val()+'"]').removeClass("hide")});$("#widget-selector").trigger("change");t();e()};function c(){$('[data-location="drafts"]').insertAfter($('[data-location="drafts"]').closest(".tab-content"));$("#widgets .available-widgets .widget-panel").draggable({helper:function(a){return $(a.target).parents(".widget-panel").clone()},distance:10,connectToSortable:".widget-area"});$("#widgets .available-containers .containers > [data-container-html]").draggable({helper:function(a){var t=$(a.target);t=t.attr("data-container-html")?t:t.parents("[data-container-html]");return t.clone().addClass("block").width(t.width()).css("opacity","0.5")},distance:10}).each(function(){$(this).attr("data-container-html",$(this).attr("data-container-html").replace(/\\\{([\s\S]*?)\\\}/g,"{$1}"))});$("#widgets .widget-area").sortable({update:function(a,t){o(t.item);p(t.item)},connectWith:"div"}).on("click",".delete-widget",function(){var t=$(this).parents(".widget-panel");bootbox.confirm("[[admin/extend/widgets:alert.confirm-delete]]",function(a){if(a){t.remove()}})}).on("mouseup","> .panel > .panel-heading",function(a){if(!($(this).parent().is(".ui-sortable-helper")||$(a.target).closest(".delete-widget").length)){$(this).parent().children(".panel-body").toggleClass("hidden")}});$("#save").on("click",a);function a(){var d=[];$("#widgets [data-template][data-location]").each(function(a,t){t=$(t);var e=t.attr("data-template");var n=t.attr("data-location");var i=t.children(".widget-area");var r=[];i.find(".widget-panel[data-widget]").each(function(){var a={};var t=$(this).find("form").serializeArray();for(var e in t){if(t.hasOwnProperty(e)){if(t[e].name){if(a[t[e].name]){if(!Array.isArray(a[t[e].name])){a[t[e].name]=[a[t[e].name]]}a[t[e].name].push(t[e].value)}else{a[t[e].name]=t[e].value}}}}r.push({widget:$(this).attr("data-widget"),data:a})});d.push({template:e,location:n,widgets:r})});socket.emit("admin.widgets.set",d,function(a){if(a){app.alertError(a.message)}app.alert({alert_id:"admin:widgets",type:"success",title:"[[admin/extend/widgets:alert.updated]]",message:"[[admin/extend/widgets:alert.update-success]]",timeout:2500})})}$(".color-selector").on("click",".btn",function(){var a=$(this);var t=a.parents(".color-selector");var e=t.parents("[data-container-html]");var n=[];t.children().each(function(){n.push($(this).attr("data-class"))});e.removeClass(n.join(" ")).addClass(a.attr("data-class"));e.attr("data-container-html",e.attr("data-container-html").replace(/class="[a-zA-Z0-9-\s]+"/,'class="'+e[0].className.replace(" pointer ui-draggable","")+'"'))})}function o(a){var t=(new Date).getFullYear();a.find(".date-selector").datepicker({changeMonth:true,changeYear:true,yearRange:t+":"+(t+100)})}function p(a){if(!a.hasClass("block")){a.addClass("block").css("width","").css("height","").droppable({accept:"[data-container-html]",drop:function(a,t){var e=$(this);e.find(".panel-body .container-html").val(t.draggable.attr("data-container-html"));e.find(".panel-body").removeClass("hidden")},hoverClass:"panel-info"}).children(".panel-heading").append('<div class="pull-right pointer"><span class="delete-widget"><i class="fa fa-times-circle"></i></span></div><div class="pull-left pointer"><span class="toggle-widget"><i class="fa fa-chevron-circle-down"></i></span>&nbsp;</div>').children("small").html("")}}function t(){function s(a,e){if(e.title){var t=a.find(".panel-heading strong");t.text(t.text()+" - "+e.title)}a.find("input, textarea, select").each(function(){var a=$(this);var t=e[a.attr("name")];if(a.attr("type")==="checkbox"){a.prop("checked",!!t).trigger("change")}else{a.val(t)}});return a}$.get(RELATIVE_PATH+"/api/admin/extend/widgets",function(a){var t=a.areas;for(var e=0;e<t.length;e+=1){var n=t[e];var i=$('#widgets .area[data-template="'+n.template+'"][data-location="'+n.location+'"]').find(".widget-area");i.html("");for(var r=0;r<n.data.length;r+=1){var d=n.data[r];var l=$('.available-widgets [data-widget="'+d.widget+'"]').clone(true).removeClass("hide");i.append(s(l,d.data));p(l);o(l)}}c()})}function e(){var a=$('[component="clone"]');var c=$('[component="clone/button"]');a.find(".dropdown-menu li").on("click",function(){var a=$(this).find("a").text();c.translateHtml("[[admin/extend/widgets:clone-from]] <strong>"+a+"</strong>");c.attr("data-template",a)});c.on("click",function(){var a=c.attr("data-template");if(!a){return app.alertError("[[admin/extend/widgets:error.select-clone]]")}var t=$("#active-widgets .active.tab-pane[data-template] .area");var e=$('#active-widgets .tab-pane[data-template="'+a+'"] .area');var n=t.map(function(){return $(this).attr("data-location")}).get();var i=e.map(function(){var a=$(this).attr("data-location");return n.indexOf(a)!==-1?a:undefined}).get().filter(function(a){return a});function r(t){$('#active-widgets .tab-pane[data-template="'+a+'"] [data-location="'+t+'"]').each(function(){$(this).find("[data-widget]").each(function(){var a=$(this).clone(true);$('#active-widgets .active.tab-pane[data-template]:not([data-template="global"]) [data-location="'+t+'"] .widget-area').append(a)})})}for(var d=0,l=i.length;d<l;d++){var s=i[d];r(s)}app.alertSuccess("[[admin/extend/widgets:alert.clone-success]]")})}return a});
//# sourceMappingURL=public/src/admin/extend/widgets.js.map